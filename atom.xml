<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>OMG_By</title>
  
  <subtitle>你走与不走，路就在那里</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2018-10-21T14:57:24.703Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>OMG_By</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Redis原理----通信协议</title>
    <link href="http://yoursite.com/2018/10/21/Redis/Redis%E5%8E%9F%E7%90%86----%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/"/>
    <id>http://yoursite.com/2018/10/21/Redis/Redis原理----通信协议/</id>
    <published>2018-10-21T11:34:13.000Z</published>
    <updated>2018-10-21T14:57:24.703Z</updated>
    
    <content type="html"><![CDATA[<p>Redis的作者认为数据库系统的瓶颈一般不在于网络流量，而是数据库自身内部逻辑处理上。所以即使Redis使用了浪费流量的文本协议，依然可以取得极高的访问性能。Redis将所有数据都放在内存，用一个单线程对外提供服务，单个节点在跑满一个CPU核心的情况下可以达到10w/s的超高QPS。</p><h2 id="RESP"><a href="#RESP" class="headerlink" title="RESP"></a>RESP</h2><p>RESP（Redis Serialization Protocol）是Redis序列化协议的简写。它是一种直观的文本协议，优势在于实现异常简单，解析性能极好。</p><p>Redis歇息将传输的数据结构分为5种最小单元类型，单元结束时统一加上回车换行符号\r\n。  </p><ul><li>单行字符以<font color="red">+</font>符号开头</li><li>多行字符以<font color="red">$</font>符号开头，后跟字符串长度</li><li>整数值以<font color="red">：</font>符号开头，后跟整数的字符串形式</li><li>错误消息以<font color="red">-</font>符号开头</li><li>数组以<font color="red">*</font>符号开头，后跟数组的长度</li></ul><p>单行字符<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">+hello world\r\n</div></pre></td></tr></table></figure></p><p>多行字符串<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$11\r\n  </div><div class="line">hello world\r\n</div><div class="line">```  </div><div class="line"></div><div class="line">整数</div></pre></td></tr></table></figure></p><p>:1024\r\n<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">错误</div></pre></td></tr></table></figure></p><p>-WRONGTYPE Operation ….<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">数组[1,2,3]</div></pre></td></tr></table></figure></p><p>*3\r\n<br>:1\r\n<br>:2\r\n<br>:3\r\n<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;!--more--&gt;</div><div class="line">## 客户端-&gt;服务器 ##</div><div class="line">客户端向服务器发送的指令只有一种格式，多行字符串数组。比如一个简单的set指令set k v会被序列化成以下字符串。</div></pre></td></tr></table></figure></p><p>*3\r\n<br>$3\r\n<br>set\r\n<br>$1\r\n<br>k\r\n<br>$1\r\n<br>v\r\n<br>```</p><h2 id="服务器-gt-客户端"><a href="#服务器-gt-客户端" class="headerlink" title="服务器-&gt;客户端"></a>服务器-&gt;客户端</h2><p>服务器向客户端恢复的响应要支持多种数据结构，所以消息响应在结构上要复杂不少。不过在复杂的响应消息也是以上的5种基本类型的组合。</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>Redis协议里有大量冗余的回车换行符，但是这并不影响它成为互联网技术领域非常受欢迎的一个文本歇息。有很多开源项目目前使用RESP作为它的通讯协议。在技术领域性能并不是一切，还有简单性、易理解性和易实现性，这些都是需要进行适当权衡的。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Redis的作者认为数据库系统的瓶颈一般不在于网络流量，而是数据库自身内部逻辑处理上。所以即使Redis使用了浪费流量的文本协议，依然可以取得极高的访问性能。Redis将所有数据都放在内存，用一个单线程对外提供服务，单个节点在跑满一个CPU核心的情况下可以达到10w/s的超
      
    
    </summary>
    
      <category term="Redis" scheme="http://yoursite.com/categories/Redis/"/>
    
    
      <category term="Redis" scheme="http://yoursite.com/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis原理----线程IO模型</title>
    <link href="http://yoursite.com/2018/10/20/Redis/Redis%E5%8E%9F%E7%90%86----%E7%BA%BF%E7%A8%8BIO%E6%A8%A1%E5%9E%8B/"/>
    <id>http://yoursite.com/2018/10/20/Redis/Redis原理----线程IO模型/</id>
    <published>2018-10-20T11:34:13.000Z</published>
    <updated>2018-10-20T15:45:50.396Z</updated>
    
    <content type="html"><![CDATA[<p><b>Redis是一个单线程程序</b></p><h2 id="非阻塞IO"><a href="#非阻塞IO" class="headerlink" title="非阻塞IO"></a>非阻塞IO</h2><p>当我们调用套接字的读写方法，默认他们是阻塞的，比如read方法要传递一个参数n，表示最多读取这门多字节后返回，如果一个字节都没有，那么线程就会卡在那里，直到新的数据到来或者连接关闭，read方法才可以返回，线程才能够继续处理。而write方法一般来说不会阻塞，除非内核为套接字分配的写缓冲区已经写满了，write方法才会阻塞，直到缓冲区有空闲空间。<img src="https://i.imgur.com/0sE9kXD.png" alt=""><br>非阻塞IO在套接字对象上提供了一个选项Non_Blocking,当这个选项打开时，读写方法不会阻塞。能读多少取决于内核为套接字分配的读缓冲区的空闲空间字节数，能写多少取决于内核为套接字分配的写缓冲区的空闲空间字节数。读方法和写方法都会通过返回值来告知程序实际读写了多少字节。</p><h2 id="事件轮询（多路复用）"><a href="#事件轮询（多路复用）" class="headerlink" title="事件轮询（多路复用）"></a>事件轮询（多路复用）</h2><p>非阻塞IO有个问题，就是线程要读数据，但是读了一部分就返回了，线程如何知道什么时候应该继续读，也就是当数据到来时，线程如何得到通知。写也是一样。<img src="https://i.imgur.com/bxF8jbN.png" alt=""><br>事件轮询API就是用来解决这个问题的，最简单的时间轮询API是select函数，它是操作系统提供给用户程序的API。输入时读写描述符列表read_fds &amp; write_fds，输出是与之对应的可读可写时间。同时还提供了一个timeout参数，如果没有任何事件的到来，那么最多等待timeout时间，线程处于阻塞状态。一旦期间有事件到来，就可以立即返回。线程就可以继续挨个处理相应的事件。处理完了继续过来轮询。于是线程就进入了一个死循环。我们把这个死循环称为事件轮询，一个循环为一个周期。<br><b>事件轮询API就是Java语言中的NIO技术</b></p><h2 id="指令队列"><a href="#指令队列" class="headerlink" title="指令队列"></a>指令队列</h2><p>Redis会将每个客户端套接字都关联一个指令队列。客户端的指令通过队列来排队进行顺序处理，先到先服务。</p><h2 id="响应队列"><a href="#响应队列" class="headerlink" title="响应队列"></a>响应队列</h2><p>Redis同样会为每个客户端套接字关联一个响应队列。<br>Redis服务器通过响应队列来将指令的返回结果回复给客户端。如果队列为空，那么以为这连接暂时处于空闲状态，不需要去获取写事件，也就是可以将当前的客户端描述符从write_fds里面移除。等到队列有数据了，再将描述符放进去。避免select系统调用立即返回写事件，结果发现没什么数据可以写。<b>出现这种情况的线程会飙高CPU</b></p><h2 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h2><p>服务器处理要响应的IO事件外，还要处理其他事情。比如定时任务。<br>如果线程阻塞在select系统调用上，定时任务将无法得到准时调度。那么Redis是如何解决这个问题的呢？  </p><p>Redis的定时任务会记录在一个最小堆的数据结构中。这个堆中，最快要执行的任务排在堆的最上方。在每个循环周期，Redis都会将最小堆里面已经到点的任务立即进行处理。处理完毕后，将最快要执行的任务还需要的时间记录下来，这个时间就是select系统调用的timeout参数。因为Redis知道未来timeout时间内，没有其他定时任务需要处理，所以可以安心睡眠timeout时间。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;b&gt;Redis是一个单线程程序&lt;/b&gt;&lt;/p&gt;
&lt;h2 id=&quot;非阻塞IO&quot;&gt;&lt;a href=&quot;#非阻塞IO&quot; class=&quot;headerlink&quot; title=&quot;非阻塞IO&quot;&gt;&lt;/a&gt;非阻塞IO&lt;/h2&gt;&lt;p&gt;当我们调用套接字的读写方法，默认他们是阻塞的，比如read方
      
    
    </summary>
    
      <category term="Redis" scheme="http://yoursite.com/categories/Redis/"/>
    
    
      <category term="Redis" scheme="http://yoursite.com/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>reset master和reset slave</title>
    <link href="http://yoursite.com/2018/09/23/mysql/reset%20master%E5%92%8Crester%20slave/"/>
    <id>http://yoursite.com/2018/09/23/mysql/reset master和rester slave/</id>
    <published>2018-09-23T08:11:15.000Z</published>
    <updated>2018-09-23T15:03:05.042Z</updated>
    
    <content type="html"><![CDATA[<h3 id="reset-master"><a href="#reset-master" class="headerlink" title="reset master"></a>reset master</h3><p>删除index file中记录的所有binlog文件，将日志索引文件清空，创建一个新的日志文件，这个命令通常用于第一次搭建主从关系的主库。  </p><h4 id="reset-master和purge-binary-log的区别"><a href="#reset-master和purge-binary-log的区别" class="headerlink" title="reset master和purge binary log的区别"></a>reset master和purge binary log的区别</h4><ol><li>reset master 删除日志索引文件中记录的所有binlog文件，出纳金一个新的日志文件，起始值从000001开始，purge binary log 命令不会修改记录binlog顺序的数值</li><li>reset master 不能用于有任何slave正在运行的主从关系的主库。因为在slave运行时刻reset master命令不被支持。从库此时会报错。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">In MySQL 5.6.5 and later, RESET MASTER also clears the values of the gtid_purged system variable (known as gtid_lost in MySQL 5.6.8 and earlier) as well as the global value of the gtid_executed (gtid_done, prior to MySQL 5.6.9) system variable (but not its session value); that is, executing this statement sets each of these values to an empty string (&apos;&apos;)</div></pre></td></tr></table></figure></li></ol><h3 id="reset-slave"><a href="#reset-slave" class="headerlink" title="reset slave"></a>reset slave</h3><p>reset slave 将使slave忘记主从复制关系的位置信息。该语句用于干净的启动，它删除master.info文件和relay-log.info文件以及所有的relay log文件并重新启用一个新的relay-log文件。</p><h3 id="reset-slave-all"><a href="#reset-slave-all" class="headerlink" title="reset slave all"></a>reset slave all</h3><p>在 5.6 版本中 reset slave 并不会清理存储于内存中的复制信息比如  master host, master port, master user, or master password,也就是说如果没有使用change master 命令做重新定向，执行start slave 还是会指向旧的master 上面。<br>当从库执行reset slave之后,将mysqld shutdown 复制参数将被重置。<br>在5.6.3 版本以及以后 使用使用 RESET SLAVE ALL 来完全的清理复制连接参数信息。(Bug #11809016)<br>RESET SLAVE ALL does not clear the IGNORE_SERVER_IDS list set by CHANGE MASTER TO. This issue is fixed in MySQL 5.7. (Bug #18816897)<br>In MySQL 5.6.7 and later, RESET SLAVE causes an implicit commit of an ongoing transaction. See Section 13.3.3, “Statements That Cause an Implicit Commit”.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;reset-master&quot;&gt;&lt;a href=&quot;#reset-master&quot; class=&quot;headerlink&quot; title=&quot;reset master&quot;&gt;&lt;/a&gt;reset master&lt;/h3&gt;&lt;p&gt;删除index file中记录的所有binlog文件，将日志
      
    
    </summary>
    
      <category term="mysql" scheme="http://yoursite.com/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://yoursite.com/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>python装饰器</title>
    <link href="http://yoursite.com/2018/08/19/python/python%E8%A3%85%E9%A5%B0%E5%99%A8/"/>
    <id>http://yoursite.com/2018/08/19/python/python装饰器/</id>
    <published>2018-08-19T13:40:56.000Z</published>
    <updated>2018-08-19T14:08:06.739Z</updated>
    
    <content type="html"><![CDATA[<p>python装饰器就是用于<font color="red">扩展原来函数功能的一种函数</font>，这个函数的特殊之处在于它的返回值也是一个函数。使用python装饰器的好处就是在不用更改原函数的代码前提下给函数增加新的功能。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">原函数</div><div class="line">def func():</div><div class="line">print(&quot;hello&quot;)</div></pre></td></tr></table></figure></p><p>要想扩展一个函数的功能，最简单的方法就是直接修改原函数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">def func():</div><div class="line">print(&quot;before&quot;)</div><div class="line">print(&quot;hello&quot;)</div><div class="line">print(&quot;after&quot;)</div></pre></td></tr></table></figure></p><p>如果不想修改原函数，还是想增强函数的功能时，可以另外定义一个函数调用原函数。（类似于设计模式中的装饰模式，有组合和代理两种方式）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">def deco(func):</div><div class="line">print(&quot;before&quot;)</div><div class="line">func()</div><div class="line">print(&quot;after&quot;)</div><div class="line"></div><div class="line">def func():</div><div class="line">print(&quot;hello&quot;)</div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    f = func</div><div class="line">    deco(f)#只有把func()或者f()作为参数执行，新加入功能才会生效</div><div class="line">    print(&quot;f.__name__ is&quot;,f.__name__)#f的name就是func()</div><div class="line">    print()</div><div class="line">    #func()</div></pre></td></tr></table></figure></p><p>但是如果存在很多个类似于func的函数需要相同的扩展，那岂不是要执行deco函数许多次？<br>下面我们实现一个最简陋的装饰器：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">def deco(func):</div><div class="line">def wrapper(*args, **kwargs):</div><div class="line">print(&quot;before&quot;)</div><div class="line">func(*args, **kwargs)</div><div class="line">print(&quot;after&quot;)</div><div class="line">return wrapper</div><div class="line"></div><div class="line">@deco</div><div class="line">def func():</div><div class="line">print(&quot;hello&quot;)</div></pre></td></tr></table></figure></p><p>这里的deco函数就是最原始的装饰器，它的参数是一个函数，然后返回值也是一个函数。其中作为参数的这个函数func()就在返回函数wrapper()的内部执行。然后在函数func()前面加上@deco。<br>所以这里装饰器就像一个注入符号：有了它，拓展了原来函数的功能既不需要侵入函数内更改代码，也不需要重复执行原函数。<br>在func函数前还可以使用多个@的方式来执行多个装饰器，多个装饰器的执行顺序就是从最后一个装饰器开始执行到第一个装饰器，在执行函数本身。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">def dec1(func):  </div><div class="line">    print(&quot;1111&quot;)  </div><div class="line">    def one():  </div><div class="line">        print(&quot;2222&quot;)  </div><div class="line">        func()  </div><div class="line">        print(&quot;3333&quot;)  </div><div class="line">    return one  </div><div class="line"></div><div class="line">def dec2(func):  </div><div class="line">    print(&quot;aaaa&quot;)  </div><div class="line">    def two():  </div><div class="line">        print(&quot;bbbb&quot;)  </div><div class="line">        func()  </div><div class="line">        print(&quot;cccc&quot;)  </div><div class="line">    return two  </div><div class="line"></div><div class="line">@dec1  </div><div class="line">@dec2  </div><div class="line">def test():  </div><div class="line">    print(&quot;test test&quot;)  </div><div class="line"></div><div class="line">test()  </div><div class="line"></div><div class="line">aaaa  </div><div class="line">1111  </div><div class="line">2222  </div><div class="line">bbbb  </div><div class="line">test test  </div><div class="line">cccc  </div><div class="line">3333</div></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;python装饰器就是用于&lt;font color=&quot;red&quot;&gt;扩展原来函数功能的一种函数&lt;/font&gt;，这个函数的特殊之处在于它的返回值也是一个函数。使用python装饰器的好处就是在不用更改原函数的代码前提下给函数增加新的功能。&lt;br&gt;&lt;figure class=&quot;hig
      
    
    </summary>
    
      <category term="python" scheme="http://yoursite.com/categories/python/"/>
    
    
      <category term="python" scheme="http://yoursite.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>innobackupex的备份和恢复</title>
    <link href="http://yoursite.com/2018/08/17/mysql/innobackupex%E7%9A%84%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D/"/>
    <id>http://yoursite.com/2018/08/17/mysql/innobackupex的备份和恢复/</id>
    <published>2018-08-17T03:05:58.000Z</published>
    <updated>2018-08-19T14:09:58.649Z</updated>
    
    <content type="html"><![CDATA[<p>还原分为3个阶段：backup（备份）、prepare（预恢复）、restore（恢复）  </p><p>首先复制所有的innodb数据文件，这样复制出来的文件肯定是不一致的，然后对每个文件进行崩溃恢复处理，最终达到一致。  </p><p>XtraBackup在启动的时候会记录一个LSN（log sequence number)，然后就把所有的innodb数据文件复制出来，这样复制出来的数据文件是不一致的。但是XtraBackup会在后台运行一个进程把所有对redo log file的修改记录下来。</p><p>以上步骤完成后innobackupex就会去备份MyIsam表和.frm文件，这时要保证数据的一致性就会先锁表，通过FLUSH TABLES WITH READ LOCK命令锁表后把文件复制出来，再释放掉这个锁。</p><p>在恢复数据的时候，要经过prepare和restore两个步骤。在prepare结束以后，innodb的表恢复到了复制innodb文件结束的时间点，这个时间点也就是锁表复制MyIsam表的起点，所以最终数据是一致的。一般我们在恢复的时候执行了两次prepare，是因为第二次prepare会帮助我们生成redo log文件，从而加快MySQL数据库启动的速度。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;还原分为3个阶段：backup（备份）、prepare（预恢复）、restore（恢复）  &lt;/p&gt;
&lt;p&gt;首先复制所有的innodb数据文件，这样复制出来的文件肯定是不一致的，然后对每个文件进行崩溃恢复处理，最终达到一致。  &lt;/p&gt;
&lt;p&gt;XtraBackup在启动的时
      
    
    </summary>
    
      <category term="mysql" scheme="http://yoursite.com/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://yoursite.com/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>mysqldump和mysqlbinlog</title>
    <link href="http://yoursite.com/2018/08/16/mysql/mysqldump/"/>
    <id>http://yoursite.com/2018/08/16/mysql/mysqldump/</id>
    <published>2018-08-16T15:49:08.000Z</published>
    <updated>2018-08-16T16:19:53.493Z</updated>
    
    <content type="html"><![CDATA[<p>mysqldump常用于MySQL数据库逻辑备份</p><h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p>1、mysqldump -uroot -p [–all-databases] [database name] &gt; [dump file]<br>上述命令会将制定数据库备份到某dump文件（转储文件）中，生成的dump文件中包含建表语句（生成数据库结构）和插入数据的insert语句。<br>2、如果加上–opt参数  </p><ul><li>建表语句中包含drop table if exists tableName  </li><li>inert之前包含一个锁表语句lock tables tableName write,insert之后包含unlock tables<br>3、mysqldump –host=host1 –opt sourceDb|mysql –host=host2 -C targetDb<br>使用以上命令可以将host1上的sourceDb复制到host2的targetDb，前提是目标主机的targetDb已经创建。<br>4、使用–no-data将只备份表结构。<br>5、mysql [database name] &lt; [backup file name]从备份文件恢复到数据库  <a id="more"></a><h3 id="mysqldump全量备份-mysqlbinlog二进制日志增量备份"><a href="#mysqldump全量备份-mysqlbinlog二进制日志增量备份" class="headerlink" title="mysqldump全量备份+mysqlbinlog二进制日志增量备份"></a>mysqldump全量备份+mysqlbinlog二进制日志增量备份</h3>从mysqldump备份文件恢复数据会丢失掉从备份点开始的更新数据，所以还需要结合mysqlbinlog二进制日志增量备份。确保已启动二进制文件。  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[mysqld]</div><div class="line">log-bin = mysql-bin</div></pre></td></tr></table></figure></li></ul><p>mysqldump命令必须带上–flush-logs选项生成新的二进制文件<br>mysqldump –single-transaction –flush-logs –master-data &gt; backup.sql<br>那么在恢复时先导入mysqldump的全量备份后，再导入mysqlbinlog二进制日志的增量备份。<br>此外，mysqlbinlog还可以指定–start-data、–stop-date、–start-position和–stop-position参数，用于精确恢复数据到某个时刻之前或者跳过中间某个出问题时间段。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">5.9.3.1. 指定恢复时间</div><div class="line">对于MySQL 4.1.4，可以在mysqlbinlog语句中通过--start-date和--stop-date选项指定DATETIME格式的起止时间。举例说明，假设在今天上午10:00(今天是2005年4月20日)，执行SQL语句来删除一个大表。要想恢复表和数据，你可以恢复前晚上的备份，并输入：</div><div class="line">mysqlbinlog --stop-date=&quot;2005-04-20 9:59:59&quot; /var/log/mysql/bin.123456 \</div><div class="line">     | mysql -u root -pmypwd</div><div class="line">该命令将恢复截止到在--stop-date选项中以DATETIME格式给出的日期和时间的所有数据。如果你没有检测到几个小时后输入的错误的SQL语句，可能你想要恢复后面发生的活动。根据这些，你可以用起使日期和时间再次运行mysqlbinlog：</div><div class="line"></div><div class="line">mysqlbinlog --start-date=&quot;2005-04-20 10:01:00&quot; /var/log/mysql/bin.123456 \</div><div class="line">     | mysql -u root -pmypwd \</div><div class="line">在该行中，从上午10:01登录的SQL语句将运行。组合执行前夜的转储文件和mysqlbinlog的两行可以将所有数据恢复到上午10:00前一秒钟。你应检查日志以确保时间确切。下一节介绍如何实现。</div><div class="line"></div><div class="line">5.9.3.2. 指定恢复位置</div><div class="line">也可以不指定日期和时间，而使用mysqlbinlog的选项--start-position和--stop-position来指定日志位置。它们的作用与起止日选项相同，不同的是给出了从日志起的位置号。使用日志位置是更准确的恢复方法，特别是当由于破坏性SQL语句同时发生许多事务的时候。要想确定位置号，可以运行mysqlbinlog寻找执行了不期望的事务的时间范围，但应将结果重新指向文本文件以便进行检查。操作方法为：</div><div class="line">mysqlbinlog --start-date=&quot;2005-04-20 9:55:00&quot; --stop-date=&quot;2005-04-20 10:05:00&quot; \</div><div class="line">      /var/log/mysql/bin.123456 &gt; /tmp/mysql_restore.sql</div><div class="line">该命令将在/tmp目录创建小的文本文件，将显示执行了错误的SQL语句时的SQL语句。你可以用文本编辑器打开该文件，寻找你不要想重复的语句。如果二进制日志中的位置号用于停止和继续恢复操作，应进行注释。用log_pos加一个数字来标记位置。使用位置号恢复了以前的备份文件后，你应从命令行输入下面内容：</div><div class="line"></div><div class="line">mysqlbinlog --stop-position=&quot;368312&quot; /var/log/mysql/bin.123456 \</div><div class="line">    | mysql -u root -pmypwd </div><div class="line"> </div><div class="line">mysqlbinlog --start-position=&quot;368315&quot; /var/log/mysql/bin.123456 \</div><div class="line">    | mysql -u root -pmypwd \ </div><div class="line">上面的第1行将恢复到停止位置为止的所有事务。下一行将恢复从给定的起始位置直到二进制日志结束的所有事务。因为mysqlbinlog的输出包括每个SQL语句记录之前的SET TIMESTAMP语句，恢复的数据和相关MySQL日志将反应事务执行的原时间。</div></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;mysqldump常用于MySQL数据库逻辑备份&lt;/p&gt;
&lt;h3 id=&quot;用法&quot;&gt;&lt;a href=&quot;#用法&quot; class=&quot;headerlink&quot; title=&quot;用法&quot;&gt;&lt;/a&gt;用法&lt;/h3&gt;&lt;p&gt;1、mysqldump -uroot -p [–all-databases] [database name] &amp;gt; [dump file]&lt;br&gt;上述命令会将制定数据库备份到某dump文件（转储文件）中，生成的dump文件中包含建表语句（生成数据库结构）和插入数据的insert语句。&lt;br&gt;2、如果加上–opt参数  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;建表语句中包含drop table if exists tableName  &lt;/li&gt;
&lt;li&gt;inert之前包含一个锁表语句lock tables tableName write,insert之后包含unlock tables&lt;br&gt;3、mysqldump –host=host1 –opt sourceDb|mysql –host=host2 -C targetDb&lt;br&gt;使用以上命令可以将host1上的sourceDb复制到host2的targetDb，前提是目标主机的targetDb已经创建。&lt;br&gt;4、使用–no-data将只备份表结构。&lt;br&gt;5、mysql [database name] &amp;lt; [backup file name]从备份文件恢复到数据库
    
    </summary>
    
      <category term="mysql" scheme="http://yoursite.com/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://yoursite.com/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>MySQL主从复制</title>
    <link href="http://yoursite.com/2018/08/16/mysql/MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/"/>
    <id>http://yoursite.com/2018/08/16/mysql/MySQL主从复制/</id>
    <published>2018-08-16T07:11:15.000Z</published>
    <updated>2018-08-16T13:31:07.906Z</updated>
    
    <content type="html"><![CDATA[<h3 id="什么是主从复制"><a href="#什么是主从复制" class="headerlink" title="什么是主从复制"></a>什么是主从复制</h3><p>将主数据库中的DDL和DML操作通过二进制日志文件传输到从数据库上，然后将这些日志重新执行（重做）；从而使从数据库的数据和主数据库的数据保持一致。</p><h3 id="主从复制的作用"><a href="#主从复制的作用" class="headerlink" title="主从复制的作用"></a>主从复制的作用</h3><ul><li>主数据库出现问题时，可以切换到从数据库</li><li>可以在数据库层面进行读写分离</li><li>可以在从数据库上进行备份操作</li></ul><h3 id="复制过程"><a href="#复制过程" class="headerlink" title="复制过程"></a>复制过程</h3><p><img src="http://ocx5m3vc3.bkt.clouddn.com/mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.png" alt=""><br>Binary log：主数据库的二进制文件<br>Relay log：从服务器的中继日志<br><a id="more"></a></p><ol><li>master在每个事物更新数据完成之前，将该操作记录串行地写入binlog文件中。</li><li>salve开启一个I/O线程，该线程在master打开一个普通连接，主要工作是binlog dump process。如果读取的进度已经跟上了master，就进入睡眠状态并等待master产生新的时间。I/O线程最终的目的是将这些事件写入到中继日志中。</li><li>SQL线程会读取中继日志，并顺序执行该日志中的SQL时间，从而与主数据库中的数据保持一致。</li></ol><h3 id="配置主从"><a href="#配置主从" class="headerlink" title="配置主从"></a>配置主从</h3><p>一、主服务器</p><ul><li>开启二进制日志</li><li>配置唯一的server-id</li><li>创建一个用于slave和master通信的用户账号</li><li>获得master二进制日志文件名及位置<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[mysqld]</div><div class="line">skip-name-resolve</div><div class="line">basedir = /home/huzb/mysql</div><div class="line">datadir = /home/huzb/mysql/data</div><div class="line">port = 23307</div><div class="line">server_id = 119961011</div><div class="line">socket = /home/huzb/mysql/mysql_23307.sock</div><div class="line">log-bin = master-bin</div><div class="line">log-bin-index = master-bin.index</div><div class="line"> </div><div class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</div><div class="line"> </div><div class="line">[client]</div><div class="line">port = 23307</div><div class="line">socket = /home/huzb/mysql/mysql_23307.sock</div></pre></td></tr></table></figure></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">#添加复制权限的用户</div><div class="line"></div><div class="line">mysql&gt; CREATE USER &apos;repl&apos;@&apos;100.73.41.62&apos; IDENTIFIED BY &apos;slavepass&apos;;</div><div class="line">mysql&gt; GRANT REPLICATION SLAVE ON *.* TO &apos;repl&apos;@&apos;100.73.41.62&apos;;</div><div class="line"></div><div class="line">mysql&gt; flush privileges;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#查看master状态</div><div class="line"></div><div class="line">mysql&gt; show master status;</div></pre></td></tr></table></figure><p>二、从服务器：</p><ul><li>配置唯一的server-id</li><li>使用master分配的用户账号读取master二进制日志</li><li>启动slave服务<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[mysqld]</div><div class="line">skip-name-resolve</div><div class="line">basedir = /home/huzb/mysql</div><div class="line">datadir = /home/huzb/mysql/data</div><div class="line">port = 23306</div><div class="line">server_id = 220180801</div><div class="line">socket = /home/huzb/mysql/mysql_23306.sock</div><div class="line">relay-log = slave-relay-bin</div><div class="line">relay-log-index = slave-relay-bin.index</div><div class="line"> </div><div class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</div><div class="line"> </div><div class="line">[client]</div><div class="line">port = 23306</div><div class="line">socket = /home/huzb/mysql/mysql_23306.sock</div></pre></td></tr></table></figure></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">#添加master信息</div><div class="line"></div><div class="line">mysql&gt; CHANGE MASTER TO</div><div class="line"></div><div class="line">MASTER_HOST=&apos;100.73.41.53&apos;,</div><div class="line">MASTER_PORT=23307,</div><div class="line">MASTER_USER=&apos;repl&apos;,</div><div class="line">MASTER_PASSWORD=&apos;slavepass&apos;,</div><div class="line">MASTER_LOG_FILE=&apos;master-bin.000001&apos;,</div><div class="line">MASTER_LOG_POS=629;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#启动slave进程</div><div class="line"></div><div class="line">mysql&gt; start slave;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#查看slave状态</div><div class="line"></div><div class="line">当Slave_IO_Running和Slave_SQL_Running都为YES的时候就表示主从同步设置成功了。</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;什么是主从复制&quot;&gt;&lt;a href=&quot;#什么是主从复制&quot; class=&quot;headerlink&quot; title=&quot;什么是主从复制&quot;&gt;&lt;/a&gt;什么是主从复制&lt;/h3&gt;&lt;p&gt;将主数据库中的DDL和DML操作通过二进制日志文件传输到从数据库上，然后将这些日志重新执行（重做）；从而使从数据库的数据和主数据库的数据保持一致。&lt;/p&gt;
&lt;h3 id=&quot;主从复制的作用&quot;&gt;&lt;a href=&quot;#主从复制的作用&quot; class=&quot;headerlink&quot; title=&quot;主从复制的作用&quot;&gt;&lt;/a&gt;主从复制的作用&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;主数据库出现问题时，可以切换到从数据库&lt;/li&gt;
&lt;li&gt;可以在数据库层面进行读写分离&lt;/li&gt;
&lt;li&gt;可以在从数据库上进行备份操作&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;复制过程&quot;&gt;&lt;a href=&quot;#复制过程&quot; class=&quot;headerlink&quot; title=&quot;复制过程&quot;&gt;&lt;/a&gt;复制过程&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;http://ocx5m3vc3.bkt.clouddn.com/mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;Binary log：主数据库的二进制文件&lt;br&gt;Relay log：从服务器的中继日志&lt;br&gt;
    
    </summary>
    
      <category term="mysql" scheme="http://yoursite.com/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://yoursite.com/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>MySQL之备份</title>
    <link href="http://yoursite.com/2018/08/11/mysql/MySQL%E4%B9%8B%E5%A4%87%E4%BB%BD/"/>
    <id>http://yoursite.com/2018/08/11/mysql/MySQL之备份/</id>
    <published>2018-08-11T08:11:15.000Z</published>
    <updated>2018-08-19T09:13:30.110Z</updated>
    
    <content type="html"><![CDATA[<h2 id="备份的类型"><a href="#备份的类型" class="headerlink" title="备份的类型"></a>备份的类型</h2><h3 id="根据是否需要数据库离线"><a href="#根据是否需要数据库离线" class="headerlink" title="根据是否需要数据库离线"></a>根据是否需要数据库离线</h3><p>1、取决于业务的需求，而不是备份工具。<br>2、MyISAM不支持热备，INNODB支持热备，但是需要专门的工具。  </p><ul><li>冷备：需要关闭mysql服务，读写请求均不支持    状态下进行。</li><li>温备：服务在线，但仅支持读请求，不允许写请求。</li><li>热备：备份的同时，业务不受影响。</li></ul><h3 id="根据备份的数据集合的范围"><a href="#根据备份的数据集合的范围" class="headerlink" title="根据备份的数据集合的范围"></a>根据备份的数据集合的范围</h3><ul><li>完全备份：备份全部字符集。</li><li>增量备份：上一次完全备份或增量备份以来改变的数据。</li><li>差异备份：上一次完全备份以来改变的数。</li></ul><h3 id="根据备份数据或文件"><a href="#根据备份数据或文件" class="headerlink" title="根据备份数据或文件"></a>根据备份数据或文件</h3><ul><li>物理备份：直接备份数据文件。</li><li>逻辑备份：备份表中的数据和代码。<a id="more"></a></li></ul><h2 id="常用的备份工具"><a href="#常用的备份工具" class="headerlink" title="常用的备份工具"></a>常用的备份工具</h2><h3 id="mysqldump"><a href="#mysqldump" class="headerlink" title="mysqldump"></a>mysqldump</h3><p>mysqldump是逻辑备份，所以使用这种备份方式数据的安全的。跨平台、版本都很容易。  </p><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><p>mysqldump的优势是可以查看或者编辑十分方面，他可以灵活的恢复之前的数据。它也不关心底层的存储引擎，即适用于支持事务的，也适用于不支持事务的的表。  </p><h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><p>mysql的缺点是如果数据过大，即使备份步骤需要的时间不算太久，但有可能恢复数据的速度很慢，因为他涉及的SQL语句插入磁盘IO，创建索引等。</p><h3 id="mysqlhotcopy"><a href="#mysqlhotcopy" class="headerlink" title="mysqlhotcopy"></a>mysqlhotcopy</h3><p>mysqlhotcopy使用lock tables、flush tables、cp和scp来快速备份数据库。</p><h4 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h4><p>它是备份数据库或单个表最快的途径，完全属于物理备份。</p><h4 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h4><p>只能用于备份MyIsam和archive存储引擎；并且是一个服务器命令，只能运行在数据库目录所在的机器上。使用mysqlhotcopy命令之前需要安装相应的软件依赖包。</p><h3 id="xtrabackup"><a href="#xtrabackup" class="headerlink" title="xtrabackup"></a>xtrabackup</h3><p>Percona XtraBackup是一款基于MySQL的物理热备份的开源实用程序。xtrabackup基于innodb的crash-recovery（实例恢复）功能，先copy innodb的物理文件（这个时候数据的一致性是无法满足的），然后进行基于redo log进行恢复，达到数据的一致性。</p><h3 id="mysqlbackup"><a href="#mysqlbackup" class="headerlink" title="mysqlbackup"></a>mysqlbackup</h3><p>首先检测并应用全备事务日志文件，然后基于全备去应用增量的log。这个时候如果有多次增量备份也可以（基于LSN点向后应用）。所有的的应用完成之后就是一个可以直接cp的数据库了。</p><h2 id="备份和恢复的实现"><a href="#备份和恢复的实现" class="headerlink" title="备份和恢复的实现"></a>备份和恢复的实现</h2><ol><li>使用select into outfile实现数据的备份和还原。<br>1.1 把需要备份的数据备份出来<br>select * from test into outfile ‘/tmp/out.txt’;<br>1.2 导入<br>load data infile ‘/tmp/out.txt’ into table XXX;</li><li>利用mysqldump工具对数据进行备份和还原<br>mysqldump常用来做温备，所以需要对想备份的数据施加读锁。<br>2.1 施加读锁的方式：<br>2.1.1 直接在备份时添加选项<br>–lock-all-tables：对要备份的数据库的所有表施加读锁。<br>–lock-table：对单表施加读锁。<br>2.1.2 在服务端书写命令<br>mysql&gt;flush tables with read lock;施加锁，表示把内存上的表统统同步到磁盘上去后施加读锁。<br>mysql&gt;flush tables with read unlock;释放锁。<br>2.2 备份策略：完全备份+增量备份+二进制文件。</li></ol><ul><li>先给数据库做全量备份</li><li>回到mysql服务器更新数据</li><li>做增量备份</li><li>到处二进制文件</li><li>让mysql离线</li></ul><ol><li>利用lvm快照实现几乎热备的数据备份和恢复</li><li>基于Xtrabackup做备份恢复<br>优势：</li></ol><ul><li>快速可靠的进行完全备份</li><li>在备份过程中会影响事务</li><li>支持数据流、网络传输、压缩，所以它可以有效的节约磁盘资源和网络带宽。</li><li>可以自动备份校验数据的可用性。</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;备份的类型&quot;&gt;&lt;a href=&quot;#备份的类型&quot; class=&quot;headerlink&quot; title=&quot;备份的类型&quot;&gt;&lt;/a&gt;备份的类型&lt;/h2&gt;&lt;h3 id=&quot;根据是否需要数据库离线&quot;&gt;&lt;a href=&quot;#根据是否需要数据库离线&quot; class=&quot;headerlink&quot; title=&quot;根据是否需要数据库离线&quot;&gt;&lt;/a&gt;根据是否需要数据库离线&lt;/h3&gt;&lt;p&gt;1、取决于业务的需求，而不是备份工具。&lt;br&gt;2、MyISAM不支持热备，INNODB支持热备，但是需要专门的工具。  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;冷备：需要关闭mysql服务，读写请求均不支持    状态下进行。&lt;/li&gt;
&lt;li&gt;温备：服务在线，但仅支持读请求，不允许写请求。&lt;/li&gt;
&lt;li&gt;热备：备份的同时，业务不受影响。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;根据备份的数据集合的范围&quot;&gt;&lt;a href=&quot;#根据备份的数据集合的范围&quot; class=&quot;headerlink&quot; title=&quot;根据备份的数据集合的范围&quot;&gt;&lt;/a&gt;根据备份的数据集合的范围&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;完全备份：备份全部字符集。&lt;/li&gt;
&lt;li&gt;增量备份：上一次完全备份或增量备份以来改变的数据。&lt;/li&gt;
&lt;li&gt;差异备份：上一次完全备份以来改变的数。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;根据备份数据或文件&quot;&gt;&lt;a href=&quot;#根据备份数据或文件&quot; class=&quot;headerlink&quot; title=&quot;根据备份数据或文件&quot;&gt;&lt;/a&gt;根据备份数据或文件&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;物理备份：直接备份数据文件。&lt;/li&gt;
&lt;li&gt;逻辑备份：备份表中的数据和代码。
    
    </summary>
    
      <category term="mysql" scheme="http://yoursite.com/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://yoursite.com/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>MySQL之权限管理</title>
    <link href="http://yoursite.com/2018/08/11/mysql/Mysql%E4%B9%8B%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/"/>
    <id>http://yoursite.com/2018/08/11/mysql/Mysql之权限管理/</id>
    <published>2018-08-11T07:11:15.000Z</published>
    <updated>2018-08-16T02:48:27.219Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、MySQL权限简介"><a href="#一、MySQL权限简介" class="headerlink" title="一、MySQL权限简介"></a>一、MySQL权限简介</h2><p>关于mysql的权限简单的理解就是mysql允许你做你权利以内的事情，不可以越界。</p><h3 id="mysql权限控制的实现"><a href="#mysql权限控制的实现" class="headerlink" title="mysql权限控制的实现"></a>mysql权限控制的实现</h3><p>第一阶段：服务器首先会检查你是否允许连接。因为创建用户的时候会加上主机限制，可以限制成本地、IP、网段、任何地方等。只允许你从配置的指定地方登陆。<br>第二阶段：Mysql会检查你发出的每个请求，看你是否有足够的权限实施它。</p><table><thead><tr><th style="text-align:center">权限</th><th style="text-align:center">权限级别</th><th style="text-align:center">权限说明</th></tr></thead><tbody><tr><td style="text-align:center">CREATE</td><td style="text-align:center">数据库、表或索引</td><td style="text-align:center">创建</td></tr><tr><td style="text-align:center">DROP</td><td style="text-align:center">数据库或表</td><td style="text-align:center">删除</td></tr><tr><td style="text-align:center">GRANT OPTION</td><td style="text-align:center">数据库、表或保存的程序</td><td style="text-align:center">赋予权限</td></tr><tr><td style="text-align:center">REFERENCES</td><td style="text-align:center">数据库或表</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">ALTER</td><td style="text-align:center">表</td><td style="text-align:center">修改表</td></tr><tr><td style="text-align:center">DELETE</td><td style="text-align:center">表</td><td style="text-align:center">删除数据</td></tr><tr><td style="text-align:center">INDEX</td><td style="text-align:center">表</td><td style="text-align:center">索引权限</td></tr></tbody></table><a id="more"></a><h2 id="二、MySQL权限实战"><a href="#二、MySQL权限实战" class="headerlink" title="二、MySQL权限实战"></a>二、MySQL权限实战</h2><ol><li>GRANT命令<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; grant all privileges on *.* to jack@&apos;localhost&apos; identified by &quot;jack&quot; with grant option;</div><div class="line">Query OK, 0 rows affected (0.01 sec)</div></pre></td></tr></table></figure></li></ol><ul><li>grant:授予权限操作。</li><li>all:具体权限。(all代表所有权限，还可以为select、update、delete等单项权限选择)</li><li>on <em>.</em>:权限操作的数据库和表。(第一个<em>代表数据库，第二个</em>代表具体的表。<em>.</em>代表所有的库和表，可以指定具体库和表）</li><li>to user@ip:被授予权限的用户和ip。</li><li>identified by “passwd”:被授予用户的密码。</li><li>with grant option:是否拥有授予其他用户权限的权限。</li></ul><ol><li>刷新权限：flush privileges;</li><li><p>查看权限：show grants;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">查看当前用户的权限：</div><div class="line">mysql&gt; show grants;</div><div class="line">+---------------------------------------------------------------------+</div><div class="line">| Grants for root@localhost                                           |</div><div class="line">+---------------------------------------------------------------------+</div><div class="line">| GRANT ALL PRIVILEGES ON *.* TO &apos;root&apos;@&apos;localhost&apos; WITH GRANT OPTION |</div><div class="line">| GRANT PROXY ON &apos;&apos;@&apos;&apos; TO &apos;root&apos;@&apos;localhost&apos; WITH GRANT OPTION        |</div><div class="line">+---------------------------------------------------------------------+</div><div class="line">2 rows in set (0.00 sec)</div><div class="line"></div><div class="line">查看某个用户的权限：</div><div class="line">mysql&gt; show grants for &apos;jack&apos;@&apos;%&apos;;</div><div class="line">+-----------------------------------------------------------------------------------------------------+</div><div class="line">| Grants for jack@%                                                                                   |</div><div class="line">+-----------------------------------------------------------------------------------------------------+</div><div class="line">| GRANT USAGE ON *.* TO &apos;jack&apos;@&apos;%&apos; IDENTIFIED BY PASSWORD &apos;*9BCDC990E611B8D852EFAF1E3919AB6AC8C8A9F0&apos; |</div><div class="line">+-----------------------------------------------------------------------------------------------------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure></li><li><p>回收权限：revoke</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; revoke delete on *.* from &apos;jack&apos;@&apos;localhost&apos;;</div><div class="line">Query OK, 0 rows affected (0.01 sec)</div></pre></td></tr></table></figure></li><li><p>删除用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; drop user &apos;jack&apos;@&apos;localhost&apos;;</div><div class="line">Query OK, 0 rows affected (0.01 sec)</div></pre></td></tr></table></figure></li><li><p>对用户重命名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; rename user &apos;jack&apos;@&apos;%&apos; to &apos;jim&apos;@&apos;%&apos;;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div></pre></td></tr></table></figure></li><li><p>修改密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">1、用set password命令</div><div class="line">mysql&gt; SET PASSWORD FOR &apos;root&apos;@&apos;localhost&apos; = PASSWORD(&apos;123456&apos;);</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line">2、用mysqladmin</div><div class="line">[root@rhel5 ~]# mysqladmin -uroot -p123456 password 1234abcd</div><div class="line">备注：</div><div class="line">格式：mysqladmin -u用户名 -p旧密码 password 新密码</div><div class="line">3、用update直接编辑user表</div><div class="line">mysql&gt; use mysql</div><div class="line">Reading table information for completion of table and column names</div><div class="line">You can turn off this feature to get a quicker startup with -A</div><div class="line"></div><div class="line">Database changed</div><div class="line">mysql&gt; update user set PASSWORD = PASSWORD(&apos;1234abcd&apos;) where user = &apos;root&apos;;</div><div class="line">Query OK, 1 row affected (0.01 sec)</div><div class="line">Rows matched: 1  Changed: 1  Warnings: 0</div><div class="line"></div><div class="line">mysql&gt; flush privileges;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line">4、在丢失root密码的时候：</div><div class="line">[root@rhel5 ~]# mysqld_safe --skip-grant-tables &amp;</div><div class="line">[1] 15953</div><div class="line">[root@rhel5 ~]# 130911 09:35:33 mysqld_safe Logging to &apos;/mysql/mysql5.5/data/rhel5.4.err&apos;.</div><div class="line">130911 09:35:33 mysqld_safe Starting mysqld daemon with databases from /mysql/mysql5.5/data</div></pre></td></tr></table></figure></li></ol><h2 id="三、MySQL权限经验原则"><a href="#三、MySQL权限经验原则" class="headerlink" title="三、MySQL权限经验原则"></a>三、MySQL权限经验原则</h2><ul><li>只授予能满足需要的最小权限。</li><li>创建用户时限制用户的登录主机，一般是限制成指定IP或内网IP段。</li><li>初始化数据库时删除没有密码的用户。</li><li>为每个用户设置满足密码复杂度的密码。</li><li>定期清理不需要的用户，回收权限或者删除用户。</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;一、MySQL权限简介&quot;&gt;&lt;a href=&quot;#一、MySQL权限简介&quot; class=&quot;headerlink&quot; title=&quot;一、MySQL权限简介&quot;&gt;&lt;/a&gt;一、MySQL权限简介&lt;/h2&gt;&lt;p&gt;关于mysql的权限简单的理解就是mysql允许你做你权利以内的事情，不可以越界。&lt;/p&gt;
&lt;h3 id=&quot;mysql权限控制的实现&quot;&gt;&lt;a href=&quot;#mysql权限控制的实现&quot; class=&quot;headerlink&quot; title=&quot;mysql权限控制的实现&quot;&gt;&lt;/a&gt;mysql权限控制的实现&lt;/h3&gt;&lt;p&gt;第一阶段：服务器首先会检查你是否允许连接。因为创建用户的时候会加上主机限制，可以限制成本地、IP、网段、任何地方等。只允许你从配置的指定地方登陆。&lt;br&gt;第二阶段：Mysql会检查你发出的每个请求，看你是否有足够的权限实施它。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center&quot;&gt;权限&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;权限级别&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;权限说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;CREATE&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;数据库、表或索引&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;创建&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;DROP&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;数据库或表&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;删除&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;GRANT OPTION&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;数据库、表或保存的程序&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;赋予权限&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;REFERENCES&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;数据库或表&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;ALTER&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;表&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;修改表&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;DELETE&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;表&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;删除数据&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;INDEX&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;表&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;索引权限&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
      <category term="mysql" scheme="http://yoursite.com/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://yoursite.com/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>information_schema</title>
    <link href="http://yoursite.com/2018/08/11/mysql/information_schema/"/>
    <id>http://yoursite.com/2018/08/11/mysql/information_schema/</id>
    <published>2018-08-11T04:11:15.000Z</published>
    <updated>2018-08-16T02:20:18.367Z</updated>
    
    <content type="html"><![CDATA[<p>information_schema数据库是mysql系统自带的数据库，它提供了数据库元数据的访问方式。可以说information_schema就是MySQL实例的一个百科全书，记录了数据库当中大部分我们需要了解的信息，比如字符集、权限相关、数据库实体对象信息、外键等。<br><a id="more"></a><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="meta">mysql&gt;</span> show tables;</div><div class="line">+---------------------------------------+</div><div class="line">| Tables_in_information_schema          |</div><div class="line">+---------------------------------------+</div><div class="line">| CHARACTER_SETS                        |</div><div class="line">| COLLATIONS                            |</div><div class="line">| COLLATION_CHARACTER_SET_APPLICABILITY |</div><div class="line">| COLUMNS                               |</div><div class="line">| COLUMN_PRIVILEGES                     |</div><div class="line">| ENGINES                               |</div><div class="line">| EVENTS                                |</div><div class="line">| FILES                                 |</div><div class="line">| GLOBAL_STATUS                         |</div><div class="line">| GLOBAL_VARIABLES                      |</div><div class="line">| KEY_COLUMN_USAGE                      |</div><div class="line">| OPTIMIZER_TRACE                       |</div><div class="line">| PARAMETERS                            |</div><div class="line">| PARTITIONS                            |</div><div class="line">| PLUGINS                               |</div><div class="line">| PROCESSLIST                           |</div><div class="line">| PROFILING                             |</div><div class="line">| REFERENTIAL_CONSTRAINTS               |</div><div class="line">| ROUTINES                              |</div><div class="line">| SCHEMATA                              |</div><div class="line">| SCHEMA_PRIVILEGES                     |</div><div class="line">| SESSION_STATUS                        |</div><div class="line">| SESSION_VARIABLES                     |</div><div class="line">| STATISTICS                            |</div><div class="line">| TABLES                                |</div><div class="line">| TABLESPACES                           |</div><div class="line">| TABLE_CONSTRAINTS                     |</div><div class="line">| TABLE_PRIVILEGES                      |</div><div class="line">| TRIGGERS                              |</div><div class="line">| USER_PRIVILEGES                       |</div><div class="line">| VIEWS                                 |</div><div class="line">| INNODB_LOCKS                          |</div><div class="line">| INNODB_TRX                            |</div><div class="line">| INNODB_SYS_DATAFILES                  |</div><div class="line">| INNODB_LOCK_WAITS                     |</div><div class="line">| INNODB_SYS_TABLESTATS                 |</div><div class="line">| INNODB_CMP                            |</div><div class="line">| INNODB_METRICS                        |</div><div class="line">| INNODB_CMP_RESET                      |</div><div class="line">| INNODB_CMP_PER_INDEX                  |</div><div class="line">| INNODB_CMPMEM_RESET                   |</div><div class="line">| INNODB_FT_DELETED                     |</div><div class="line">| INNODB_BUFFER_PAGE_LRU                |</div><div class="line">| INNODB_SYS_FOREIGN                    |</div><div class="line">| INNODB_SYS_COLUMNS                    |</div><div class="line">| INNODB_SYS_INDEXES                    |</div><div class="line">| INNODB_FT_DEFAULT_STOPWORD            |</div><div class="line">| INNODB_SYS_FIELDS                     |</div><div class="line">| INNODB_CMP_PER_INDEX_RESET            |</div><div class="line">| INNODB_BUFFER_PAGE                    |</div><div class="line">| INNODB_CMPMEM                         |</div><div class="line">| INNODB_FT_INDEX_TABLE                 |</div><div class="line">| INNODB_FT_BEING_DELETED               |</div><div class="line">| INNODB_SYS_TABLESPACES                |</div><div class="line">| INNODB_FT_INDEX_CACHE                 |</div><div class="line">| INNODB_SYS_FOREIGN_COLS               |</div><div class="line">| INNODB_SYS_TABLES                     |</div><div class="line">| INNODB_BUFFER_POOL_STATS              |</div><div class="line">| INNODB_FT_CONFIG                      |</div><div class="line">+---------------------------------------+</div><div class="line">59 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p><h3 id="SCHEMATA"><a href="#SCHEMATA" class="headerlink" title="SCHEMATA"></a>SCHEMATA</h3><p>schemata提供了关于数据库的信息。show databases的结果就取自此表。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">mysql&gt; desc schemata;</div><div class="line">+----------------------------+--------------+------+-----+---------+-------+</div><div class="line">| Field                      | Type         | Null | Key | Default | Extra |</div><div class="line">+----------------------------+--------------+------+-----+---------+-------+</div><div class="line">| CATALOG_NAME               | varchar(512) | NO   |     |         |       |</div><div class="line">| SCHEMA_NAME                | varchar(64)  | NO   |     |         |    数据库名</div><div class="line">| DEFAULT_CHARACTER_SET_NAME | varchar(32)  | NO   |     |         |    默认表字符集编码</div><div class="line">| DEFAULT_COLLATION_NAME     | varchar(32)  | NO   |     |         |    默认字符集编码排序规则</div><div class="line">| SQL_PATH                   | varchar(512) | YES  |     | NULL    |       |</div><div class="line">+----------------------------+--------------+------+-----+---------+-------+</div><div class="line">5 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from schemata;</div><div class="line">+--------------+--------------------+----------------------------+------------------------+----------+</div><div class="line">| CATALOG_NAME | SCHEMA_NAME        | DEFAULT_CHARACTER_SET_NAME | DEFAULT_COLLATION_NAME | SQL_PATH |</div><div class="line">+--------------+--------------------+----------------------------+------------------------+----------+</div><div class="line">| def          | information_schema | utf8                       | utf8_general_ci        | NULL     |</div><div class="line">| def          | hoo                | utf8                       | utf8_general_ci        | NULL     |</div><div class="line">| def          | mysql              | utf8                       | utf8_general_ci        | NULL     |</div><div class="line">| def          | performance_schema | utf8                       | utf8_general_ci        | NULL     |</div><div class="line">| def          | test               | latin1                     | latin1_swedish_ci      | NULL     |</div><div class="line">+--------------+--------------------+----------------------------+------------------------+----------+</div><div class="line">5 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p><h3 id="TABLES"><a href="#TABLES" class="headerlink" title="TABLES"></a>TABLES</h3><p>存储了数据表的元数据信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">mysql&gt; desc tables;</div><div class="line">+-----------------+---------------------+------+-----+---------+-------+</div><div class="line">| Field           | Type                | Null | Key | Default | Extra |</div><div class="line">+-----------------+---------------------+------+-----+---------+-------+</div><div class="line">| TABLE_CATALOG   | varchar(512)        | NO   |     |         |       |</div><div class="line">| TABLE_SCHEMA    | varchar(64)         | NO   |     |         |     数据库名  </div><div class="line">| TABLE_NAME      | varchar(64)         | NO   |     |         |     数据表名  |</div><div class="line">| TABLE_TYPE      | varchar(64)         | NO   |     |         |       |</div><div class="line">| ENGINE          | varchar(64)         | YES  |     | NULL    |     存储引擎  |</div><div class="line">| VERSION         | bigint(21) unsigned | YES  |     | NULL    |       |</div><div class="line">| ROW_FORMAT      | varchar(10)         | YES  |     | NULL    |     是否被压缩过  |</div><div class="line">| TABLE_ROWS      | bigint(21) unsigned | YES  |     | NULL    |     表的粗略行估计  |</div><div class="line">| AVG_ROW_LENGTH  | bigint(21) unsigned | YES  |     | NULL    |       |</div><div class="line">| DATA_LENGTH     | bigint(21) unsigned | YES  |     | NULL    |     表的大小  |</div><div class="line">| MAX_DATA_LENGTH | bigint(21) unsigned | YES  |     | NULL    |       |</div><div class="line">| INDEX_LENGTH    | bigint(21) unsigned | YES  |     | NULL    |     索引的大小  |</div><div class="line">| DATA_FREE       | bigint(21) unsigned | YES  |     | NULL    |       |</div><div class="line">| AUTO_INCREMENT  | bigint(21) unsigned | YES  |     | NULL    |       |</div><div class="line">| CREATE_TIME     | datetime            | YES  |     | NULL    |       |</div><div class="line">| UPDATE_TIME     | datetime            | YES  |     | NULL    |       |</div><div class="line">| CHECK_TIME      | datetime            | YES  |     | NULL    |       |</div><div class="line">| TABLE_COLLATION | varchar(32)         | YES  |     | NULL    |       |</div><div class="line">| CHECKSUM        | bigint(21) unsigned | YES  |     | NULL    |       |</div><div class="line">| CREATE_OPTIONS  | varchar(255)        | YES  |     | NULL    |       |</div><div class="line">| TABLE_COMMENT   | varchar(2048)       | NO   |     |         |       |</div><div class="line">+-----------------+---------------------+------+-----+---------+-------+</div><div class="line">21 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p><h3 id="ENGINES"><a href="#ENGINES" class="headerlink" title="ENGINES"></a>ENGINES</h3><p>引擎表，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">mysql&gt; desc engines;</div><div class="line">+--------------+-------------+------+-----+---------+-------+</div><div class="line">| Field        | Type        | Null | Key | Default | Extra |</div><div class="line">+--------------+-------------+------+-----+---------+-------+</div><div class="line">| ENGINE       | varchar(64) | NO   |     |         |     引擎名  |</div><div class="line">| SUPPORT      | varchar(8)  | NO   |     |         |     是否支持  |</div><div class="line">| COMMENT      | varchar(80) | NO   |     |         |     描述  |</div><div class="line">| TRANSACTIONS | varchar(3)  | YES  |     | NULL    |     是否支持事务  |</div><div class="line">| XA           | varchar(3)  | YES  |     | NULL    |     是否支持分布式事务  |</div><div class="line">| SAVEPOINTS   | varchar(3)  | YES  |     | NULL    |     是否支持事务回滚点  |</div><div class="line">+--------------+-------------+------+-----+---------+-------+</div><div class="line">6 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from engines;</div><div class="line">+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</div><div class="line">| ENGINE             | SUPPORT | COMMENT                                                        | TRANSACTIONS | XA   | SAVEPOINTS |</div><div class="line">+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</div><div class="line">| FEDERATED          | NO      | Federated MySQL storage engine                                 | NULL         | NULL | NULL       |</div><div class="line">| CSV                | YES     | CSV storage engine                                             | NO           | NO   | NO         |</div><div class="line">| MyISAM             | YES     | MyISAM storage engine                                          | NO           | NO   | NO         |</div><div class="line">| BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it disappears) | NO           | NO   | NO         |</div><div class="line">| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                          | NO           | NO   | NO         |</div><div class="line">| MEMORY             | YES     | Hash based, stored in memory, useful for temporary tables      | NO           | NO   | NO         |</div><div class="line">| ARCHIVE            | YES     | Archive storage engine                                         | NO           | NO   | NO         |</div><div class="line">| PERFORMANCE_SCHEMA | YES     | Performance Schema                                             | NO           | NO   | NO         |</div><div class="line">| InnoDB             | DEFAULT | Supports transactions, row-level locking, and foreign keys     | YES          | YES  | YES        |</div><div class="line">+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</div><div class="line">9 rows in set (0.01 sec)</div></pre></td></tr></table></figure></p><h3 id="COLUMNS"><a href="#COLUMNS" class="headerlink" title="COLUMNS"></a>COLUMNS</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">mysql&gt; desc columns;</div><div class="line">+--------------------------+---------------------+------+-----+---------+-------+</div><div class="line">| Field                    | Type                | Null | Key | Default | Extra |</div><div class="line">+--------------------------+---------------------+------+-----+---------+-------+</div><div class="line">| TABLE_CATALOG            | varchar(512)        | NO   |     |         |       |</div><div class="line">| TABLE_SCHEMA             | varchar(64)         | NO   |     |         |    数据库名   |</div><div class="line">| TABLE_NAME               | varchar(64)         | NO   |     |         |    表名   |</div><div class="line">| COLUMN_NAME              | varchar(64)         | NO   |     |         |    列名   |</div><div class="line">| ORDINAL_POSITION         | bigint(21) unsigned | NO   |     | 0       |    创建时排第几   |</div><div class="line">| COLUMN_DEFAULT           | longtext            | YES  |     | NULL    |    默认值   |</div><div class="line">| IS_NULLABLE              | varchar(3)          | NO   |     |         |    是否能为空   |</div><div class="line">| DATA_TYPE                | varchar(64)         | NO   |     |         |    字符数据类型   |</div><div class="line">| CHARACTER_MAXIMUM_LENGTH | bigint(21) unsigned | YES  |     | NULL    |       |</div><div class="line">| CHARACTER_OCTET_LENGTH   | bigint(21) unsigned | YES  |     | NULL    |       |</div><div class="line">| NUMERIC_PRECISION        | bigint(21) unsigned | YES  |     | NULL    |       |</div><div class="line">| NUMERIC_SCALE            | bigint(21) unsigned | YES  |     | NULL    |       |</div><div class="line">| DATETIME_PRECISION       | bigint(21) unsigned | YES  |     | NULL    |       |</div><div class="line">| CHARACTER_SET_NAME       | varchar(32)         | YES  |     | NULL    |    字符集   |</div><div class="line">| COLLATION_NAME           | varchar(32)         | YES  |     | NULL    |    字符集排序规则   |</div><div class="line">| COLUMN_TYPE              | longtext            | NO   |     | NULL    |    创表时列的类型定义   |</div><div class="line">| COLUMN_KEY               | varchar(3)          | NO   |     |         |       |</div><div class="line">| EXTRA                    | varchar(30)         | NO   |     |         |       |</div><div class="line">| PRIVILEGES               | varchar(80)         | NO   |     |         |    权限   |</div><div class="line">| COLUMN_COMMENT           | varchar(1024)       | NO   |     |         |       |</div><div class="line">+--------------------------+---------------------+------+-----+---------+-------+</div><div class="line">20 rows in set (0.00 sec)</div><div class="line"></div><div class="line"></div><div class="line">mysql&gt; select * from columns where table_schema = &apos;hoo&apos; and table_name =&apos;hoo_test&apos;\G;</div><div class="line">*************************** 1. row ***************************</div><div class="line">           TABLE_CATALOG: def</div><div class="line">            TABLE_SCHEMA: hoo</div><div class="line">              TABLE_NAME: hoo_test</div><div class="line">             COLUMN_NAME: name</div><div class="line">        ORDINAL_POSITION: 1</div><div class="line">          COLUMN_DEFAULT: NULL</div><div class="line">             IS_NULLABLE: YES</div><div class="line">               DATA_TYPE: varchar</div><div class="line">CHARACTER_MAXIMUM_LENGTH: 10</div><div class="line">  CHARACTER_OCTET_LENGTH: 30</div><div class="line">       NUMERIC_PRECISION: NULL</div><div class="line">           NUMERIC_SCALE: NULL</div><div class="line">      DATETIME_PRECISION: NULL</div><div class="line">      CHARACTER_SET_NAME: utf8</div><div class="line">          COLLATION_NAME: utf8_general_ci</div><div class="line">             COLUMN_TYPE: varchar(10)</div><div class="line">              COLUMN_KEY: </div><div class="line">                   EXTRA: </div><div class="line">              PRIVILEGES: select,insert,update,references</div><div class="line">          COLUMN_COMMENT: </div><div class="line">*************************** 2. row ***************************</div></pre></td></tr></table></figure><h3 id="KEY-COLUMN-USAGE"><a href="#KEY-COLUMN-USAGE" class="headerlink" title="KEY_COLUMN_USAGE"></a>KEY_COLUMN_USAGE</h3><p>索引列上的约束<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">mysql&gt; desc key_column_usage;</div><div class="line">+-------------------------------+--------------+------+-----+---------+-------+</div><div class="line">| Field                         | Type         | Null | Key | Default | Extra |</div><div class="line">+-------------------------------+--------------+------+-----+---------+-------+</div><div class="line">| CONSTRAINT_CATALOG            | varchar(512) | NO   |     |         |       |</div><div class="line">| CONSTRAINT_SCHEMA             | varchar(64)  | NO   |     |         |       |</div><div class="line">| CONSTRAINT_NAME               | varchar(64)  | NO   |     |         |       |</div><div class="line">| TABLE_CATALOG                 | varchar(512) | NO   |     |         |       |</div><div class="line">| TABLE_SCHEMA                  | varchar(64)  | NO   |     |         |       |</div><div class="line">| TABLE_NAME                    | varchar(64)  | NO   |     |         |       |</div><div class="line">| COLUMN_NAME                   | varchar(64)  | NO   |     |         |       |</div><div class="line">| ORDINAL_POSITION              | bigint(10)   | NO   |     | 0       |       |</div><div class="line">| POSITION_IN_UNIQUE_CONSTRAINT | bigint(10)   | YES  |     | NULL    |       |</div><div class="line">| REFERENCED_TABLE_SCHEMA       | varchar(64)  | YES  |     | NULL    |       |</div><div class="line">| REFERENCED_TABLE_NAME         | varchar(64)  | YES  |     | NULL    |       |</div><div class="line">| REFERENCED_COLUMN_NAME        | varchar(64)  | YES  |     | NULL    |       |</div><div class="line">+-------------------------------+--------------+------+-----+---------+-------+</div><div class="line">12 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from key_column_usage where table_name = &apos;test_pri&apos;\G;</div><div class="line">*************************** 1. row ***************************</div><div class="line">           CONSTRAINT_CATALOG: def</div><div class="line">            CONSTRAINT_SCHEMA: hoo</div><div class="line">              CONSTRAINT_NAME: PRIMARY</div><div class="line">                TABLE_CATALOG: def</div><div class="line">                 TABLE_SCHEMA: hoo</div><div class="line">                   TABLE_NAME: test_pri</div><div class="line">                  COLUMN_NAME: id</div><div class="line">             ORDINAL_POSITION: 1</div><div class="line">POSITION_IN_UNIQUE_CONSTRAINT: NULL</div><div class="line">      REFERENCED_TABLE_SCHEMA: NULL</div><div class="line">        REFERENCED_TABLE_NAME: NULL</div><div class="line">       REFERENCED_COLUMN_NAME: NULL</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure></p><h3 id="PROCESSLIST"><a href="#PROCESSLIST" class="headerlink" title="PROCESSLIST"></a>PROCESSLIST</h3><p>processlist显示有哪些线程在运行，可以帮助识别出有问题的查询语句。<br>show processlist 和 select * from information_schema.processlist 效果一样。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">mysql&gt; desc PROCESSLIST;</div><div class="line">+---------+---------------------+------+-----+---------+-------+</div><div class="line">| Field   | Type                | Null | Key | Default | Extra |</div><div class="line">+---------+---------------------+------+-----+---------+-------+</div><div class="line">| ID      | bigint(21) unsigned | NO   |     | 0       |    会话ID   |</div><div class="line">| USER    | varchar(16)         | NO   |     |         |    运行用户   |</div><div class="line">| HOST    | varchar(64)         | NO   |     |         |    运行主机和端口   |</div><div class="line">| DB      | varchar(64)         | YES  |     | NULL    |    操作的数据库   |</div><div class="line">| COMMAND | varchar(16)         | NO   |     |         |    显示当前线程运行的命令类型   |</div><div class="line">| TIME    | int(7)              | NO   |     | 0       |    此状态持续时间   |</div><div class="line">| STATE   | varchar(64)         | YES  |     | NULL    |    显示使用当前连接的SQL语句   |</div><div class="line">| INFO    | longtext            | YES  |     | NULL    |    显示SQL语句   |</div><div class="line">+---------+---------------------+------+-----+---------+-------+</div><div class="line">8 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from processlist;</div><div class="line">+----+------+-----------+--------------------+---------+------+-----------+---------------------------+</div><div class="line">| ID | USER | HOST      | DB                 | COMMAND | TIME | STATE     | INFO                      |</div><div class="line">+----+------+-----------+--------------------+---------+------+-----------+---------------------------+</div><div class="line">| 25 | root | localhost | information_schema | Query   |    0 | executing | select * from processlist |</div><div class="line">+----+------+-----------+--------------------+---------+------+-----------+---------------------------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure></p><p>state列值：</p><ul><li>checking table：正在检查数据表。</li><li>closing tables：正在将表中修改的数据刷新到磁盘，同时关闭已用完的表。</li><li>connect out：复制从服务器正在连接主服务器。</li><li>copying to tmp table on disk：正在将临时表从内存存储转为磁盘存储以节省内存。</li><li>creating tmp table：正在创建临时表以存放部分查询结果。</li><li>deleting from main table：服务器正在执行多表删除的第一部分，刚删除第一个表。</li><li>deleting from reference tables：服务器正在执行多表删除的第二部分，正在删除其他表的记录。</li><li>flushing tables：正在执行flush tables，等待其他线程关闭数据表。</li><li>killed：发送了一个kill请求给某线程。</li><li>locked：被其他查询锁住了。</li><li>sending data：正在处理select查询的记录，同时正在把结果发送给客户端。</li><li>sorting for group：正在为group by做排序。</li><li>sorting for order：正在为order by做排序。</li><li>opening table：正在尝试打开一个表。</li><li>removing duplicates：正在执行一个select distinct方式的查询。</li><li>sleeping：正在等待客户端发送新请求</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;information_schema数据库是mysql系统自带的数据库，它提供了数据库元数据的访问方式。可以说information_schema就是MySQL实例的一个百科全书，记录了数据库当中大部分我们需要了解的信息，比如字符集、权限相关、数据库实体对象信息、外键等。&lt;br&gt;
    
    </summary>
    
      <category term="mysql" scheme="http://yoursite.com/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://yoursite.com/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql事务</title>
    <link href="http://yoursite.com/2018/08/11/mysql/mysql%E4%BA%8B%E5%8A%A1/"/>
    <id>http://yoursite.com/2018/08/11/mysql/mysql事务/</id>
    <published>2018-08-10T16:11:15.000Z</published>
    <updated>2018-08-15T08:47:10.639Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、事务的基本要素（ACID）"><a href="#一、事务的基本要素（ACID）" class="headerlink" title="一、事务的基本要素（ACID）"></a>一、事务的基本要素（ACID）</h2><ul><li>原子性（Atomicity):事务开始后所有的操作，要么全部做完，要么全部不做，不可能在中间环节。事务执行过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发生一样。</li><li>一致性（Consistency）：事务开始前和结束后，数据库的完整性约束没有被破坏。</li><li>隔离性（Isolation）：同一时间，只允许一个事务请求同一数据，不同事务之间彼此没有任何干扰。</li><li>持久性（Durability）：事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。<a id="more"></a><h2 id="二、事务的并发问题"><a href="#二、事务的并发问题" class="headerlink" title="二、事务的并发问题"></a>二、事务的并发问题</h2></li><li>脏读：事务A读取了事务B未提交的数据。</li><li>不可重复读：事务A多次读取同一数据，事务B在事务A多次读取过程中，对数据进行了更新，导致事务A读取同一事务时结果不一致。</li><li>幻读：事务A在更新过程中，事务B对同数据库进行了操作并提交，事务A提交不成功。</li></ul><h2 id="三、Mysql事务隔离级别"><a href="#三、Mysql事务隔离级别" class="headerlink" title="三、Mysql事务隔离级别"></a>三、Mysql事务隔离级别</h2><h3 id="读未提交"><a href="#读未提交" class="headerlink" title="读未提交"></a>读未提交</h3><p>事务1对A进行操作还没提交，事务2就对A进行了读取，之后事务1对A进行再次操作或回滚，导致事务A读取的数据不对。（脏读）<br><img src="http://ocx5m3vc3.bkt.clouddn.com/%E8%AF%BB%E6%9C%AA%E6%8F%90%E4%BA%A4.png" alt="">  </p><h3 id="读已提交"><a href="#读已提交" class="headerlink" title="读已提交"></a>读已提交</h3><p>事务2多次读取同一数据，事务1在事务2读取过程中对数据进行了修改，导致事务1读取的数据不一致。（解决了脏读，不可重复读）<br><img src="http://ocx5m3vc3.bkt.clouddn.com/%E8%AF%BB%E5%B7%B2%E6%8F%90%E4%BA%A42.png" alt=""><br>读已提交是大多数数据库的默认隔离级别。</p><h3 id="可重复读"><a href="#可重复读" class="headerlink" title="可重复读"></a>可重复读</h3><p>事务与事务之间相互隔离，数据之间不相互影响。整个事务过程中多次执行同一个查询，查询得到的结果是不一样的，幻读针对的多笔记录。（解决了不可重复读，导致了幻读）</p><p>可重复读是mysql的默认隔离级别。 </p><h3 id="串行化"><a href="#串行化" class="headerlink" title="串行化"></a>串行化</h3><p>在事务进行操作时对表进行加锁操作，拒绝其他事务进行操作。保证了数据的安全性，但是效率大大降低。</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;一、事务的基本要素（ACID）&quot;&gt;&lt;a href=&quot;#一、事务的基本要素（ACID）&quot; class=&quot;headerlink&quot; title=&quot;一、事务的基本要素（ACID）&quot;&gt;&lt;/a&gt;一、事务的基本要素（ACID）&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;原子性（Atomicity):事务开始后所有的操作，要么全部做完，要么全部不做，不可能在中间环节。事务执行过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发生一样。&lt;/li&gt;
&lt;li&gt;一致性（Consistency）：事务开始前和结束后，数据库的完整性约束没有被破坏。&lt;/li&gt;
&lt;li&gt;隔离性（Isolation）：同一时间，只允许一个事务请求同一数据，不同事务之间彼此没有任何干扰。&lt;/li&gt;
&lt;li&gt;持久性（Durability）：事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。
    
    </summary>
    
      <category term="mysql" scheme="http://yoursite.com/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://yoursite.com/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>python获取本机IP</title>
    <link href="http://yoursite.com/2018/07/21/python/%E8%8E%B7%E5%8F%96%E6%9C%AC%E6%9C%BAIP/"/>
    <id>http://yoursite.com/2018/07/21/python/获取本机IP/</id>
    <published>2018-07-21T08:28:05.000Z</published>
    <updated>2018-07-21T15:27:47.365Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> socket</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_host_ip</span><span class="params">()</span>:</span></div><div class="line">  <span class="keyword">try</span>:</div><div class="line">      s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</div><div class="line">      s.connect((<span class="string">'8.8.8.8'</span>, <span class="number">80</span>))</div><div class="line">      ip = s.getsockname()[<span class="number">0</span>]</div><div class="line">  <span class="keyword">finally</span>:</div><div class="line">      s.close()</div><div class="line">  <span class="keyword">return</span> ip</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/d
      
    
    </summary>
    
      <category term="python" scheme="http://yoursite.com/categories/python/"/>
    
    
      <category term="python" scheme="http://yoursite.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Redis设计与实现-数据结构篇（6）-压缩列表</title>
    <link href="http://yoursite.com/2018/06/12/Redis/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AF%87%EF%BC%886%EF%BC%89--%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8/"/>
    <id>http://yoursite.com/2018/06/12/Redis/Redis设计与实现-数据结构篇（6）--压缩列表/</id>
    <published>2018-06-12T11:41:38.000Z</published>
    <updated>2018-08-11T16:33:20.944Z</updated>
    
    <content type="html"><![CDATA[<p>压缩列表是列表键和哈希键的底层实现之一。当一个列表键只包含少量列表项，并且每个列表项要么就是小整数类型，要么就是长度比较短的字符串，那么Redis会使用压缩列表来做列表键的底层实现。</p><h3 id="压缩列表的构成"><a href="#压缩列表的构成" class="headerlink" title="压缩列表的构成"></a>压缩列表的构成</h3><p>压缩列表是Redis为了节约内存而开发的，是由一系列特殊编码的连续内存块组成的顺序性数据结构。一个压缩列表可以包含任意多个节点，每个节点可以保存一个字节数组或者一个整数值。<br><img src="http://ocx5m3vc3.bkt.clouddn.com/ziplist.png" alt="">  </p><ul><li>zlbytes：4字节，记录整个压缩列表占用内存的字节数</li><li>zltail：4字节，记录压缩列表尾部节点距离起始地址的偏移量</li><li>zllen：2字节，记录压缩列表包含的节点数量</li><li>entry：不定，列表中的每个节点</li><li>zlend：1字节，特殊值0xFF，标记压缩列表的结束</li></ul><a id="more"></a><h3 id="压缩列表节点的构成"><a href="#压缩列表节点的构成" class="headerlink" title="压缩列表节点的构成"></a>压缩列表节点的构成</h3><p>每个压缩列表节点可以保存一个字节数组或者一个整数值。其中，字节数组可以是以下的类型：  </p><ul><li>长度小于等于63字节的字节数组</li><li>长度小于等于16381字节的字节数组</li><li>长度小于等于4294967295字节的字节数组</li></ul><p>而整数值则可以是以下类型：  </p><ul><li>4位长，介于0~12之间的无符号整数</li><li>1字节长的有符号整数</li><li>3字节长的有符号整数</li><li>int16_t类型整数</li><li>int32_t类型整数</li><li>int64_t类型整数</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">typedef struct zlentry &#123;</div><div class="line">    unsigned int prevrawlensize, prevrawlen;</div><div class="line">    unsigned int lensize, len;</div><div class="line">    unsigned int headersize;</div><div class="line">    unsigned char encoding;</div><div class="line">    unsigned char *p;</div><div class="line">&#125; zlentry;</div></pre></td></tr></table></figure><ul><li>prevrawlen：前置节点的长度</li><li>prevrawlensize：编码 prevrawlen 所需的字节大小</li><li>len：当前节点的长度</li><li>lensize：编码 len 所需的字节大小</li><li>headersize：当前节点 header 的大小，等于 prevrawlensize + lensize</li><li>encoding：当前节点值所使用的编码类型</li><li>p：指向当前节点的指针</li></ul><p>当加入新节点后，后一个节点需要保存新节点的长度信息，当后一个节点的长度字段在内存中占有的长度不足以表示该长度信息时，就需要对后一个节点进行更新，并扩展其内存。因此这个步骤可能会导致连锁更新。而删除操作也类似<br><img src="http://ocx5m3vc3.bkt.clouddn.com/ziplist%E8%BF%9E%E9%94%81%E6%9B%B4%E6%96%B0.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;压缩列表是列表键和哈希键的底层实现之一。当一个列表键只包含少量列表项，并且每个列表项要么就是小整数类型，要么就是长度比较短的字符串，那么Redis会使用压缩列表来做列表键的底层实现。&lt;/p&gt;
&lt;h3 id=&quot;压缩列表的构成&quot;&gt;&lt;a href=&quot;#压缩列表的构成&quot; class=&quot;headerlink&quot; title=&quot;压缩列表的构成&quot;&gt;&lt;/a&gt;压缩列表的构成&lt;/h3&gt;&lt;p&gt;压缩列表是Redis为了节约内存而开发的，是由一系列特殊编码的连续内存块组成的顺序性数据结构。一个压缩列表可以包含任意多个节点，每个节点可以保存一个字节数组或者一个整数值。&lt;br&gt;&lt;img src=&quot;http://ocx5m3vc3.bkt.clouddn.com/ziplist.png&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;zlbytes：4字节，记录整个压缩列表占用内存的字节数&lt;/li&gt;
&lt;li&gt;zltail：4字节，记录压缩列表尾部节点距离起始地址的偏移量&lt;/li&gt;
&lt;li&gt;zllen：2字节，记录压缩列表包含的节点数量&lt;/li&gt;
&lt;li&gt;entry：不定，列表中的每个节点&lt;/li&gt;
&lt;li&gt;zlend：1字节，特殊值0xFF，标记压缩列表的结束&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Redis" scheme="http://yoursite.com/categories/Redis/"/>
    
    
      <category term="Redis" scheme="http://yoursite.com/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis设计与实现-数据结构篇（5）-整数集合</title>
    <link href="http://yoursite.com/2018/06/11/Redis/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AF%87%EF%BC%885%EF%BC%89-%E6%95%B4%E6%95%B0%E9%9B%86%E5%90%88/"/>
    <id>http://yoursite.com/2018/06/11/Redis/Redis设计与实现-数据结构篇（5）-整数集合/</id>
    <published>2018-06-11T11:41:38.000Z</published>
    <updated>2018-08-10T17:27:19.167Z</updated>
    
    <content type="html"><![CDATA[<p>整数集合是集合键的底层实现之一，当一个集合只傲寒整数值元素，并且这个集合的元素不多时，Redis就会使用整数集合作为集合键的底层实现。</p><h3 id="整数集合的实现"><a href="#整数集合的实现" class="headerlink" title="整数集合的实现"></a>整数集合的实现</h3><p>整数集合是Redis用于保存整数值的集合抽象数据结构，它可以保存类型为int16_t、int32_t或者int64_t的整数值，并且保证集合中不会出现重复元素。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">typedef stuct intset&#123;</div><div class="line">//编码方式</div><div class="line">uint32_t encodingl</div><div class="line">//集合包含的元素数量</div><div class="line">uint32_t length;</div><div class="line">//保存元素的数组</div><div class="line">int8_t contents[];</div><div class="line">&#125;intset;</div></pre></td></tr></table></figure></p><p>contents数组是整数集合的底层实现：整数集合的每个元素都是contents数据的一个数组项，每个项在数组中按值的大小从小到大有序的排列，并且数组中不包含重复项。</p><h3 id="升级"><a href="#升级" class="headerlink" title="升级"></a>升级</h3><p>每当我们要将一个新元素添加到整数集合里面，并且新元素的类型比整数集合现有所有元素的类型都要长时，整数集合需要先进行升级，然后才能将新元素添加到整数集合里面去。</p><h4 id="升级步骤"><a href="#升级步骤" class="headerlink" title="升级步骤"></a>升级步骤</h4><ul><li>根据新元素类型，扩展整数集合底层数组的空间大小，并为新元素分配空间。</li><li>将底层数组中的元素都转换成与新元素相同的类型，并将元素放在对应的位置上，在放置过程中需要维持底层数组的有序性质不变。</li><li>将新元素加到底层数组中。<h4 id="升级的好处"><a href="#升级的好处" class="headerlink" title="升级的好处"></a>升级的好处</h4></li><li>提高灵活性</li><li>节约内存</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;整数集合是集合键的底层实现之一，当一个集合只傲寒整数值元素，并且这个集合的元素不多时，Redis就会使用整数集合作为集合键的底层实现。&lt;/p&gt;
&lt;h3 id=&quot;整数集合的实现&quot;&gt;&lt;a href=&quot;#整数集合的实现&quot; class=&quot;headerlink&quot; title=&quot;整数集
      
    
    </summary>
    
      <category term="Redis" scheme="http://yoursite.com/categories/Redis/"/>
    
    
      <category term="Redis" scheme="http://yoursite.com/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis设计与实现-数据结构篇（4）--跳跃表</title>
    <link href="http://yoursite.com/2018/06/10/Redis/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AF%87%EF%BC%884%EF%BC%89-%E8%B7%B3%E8%B7%83%E9%93%BE%E8%A1%A8/"/>
    <id>http://yoursite.com/2018/06/10/Redis/Redis设计与实现-数据结构篇（4）-跳跃链表/</id>
    <published>2018-06-10T11:41:38.000Z</published>
    <updated>2018-08-10T17:13:04.108Z</updated>
    
    <content type="html"><![CDATA[<p>跳跃表（skiplist）是一种有序数据结构，它通过在每个节点中维持多个指向其他节点的指针，从而达到快速访问节点的目的。</p><h2 id="跳跃表的实现"><a href="#跳跃表的实现" class="headerlink" title="跳跃表的实现"></a>跳跃表的实现</h2><p>Redis跳跃表由zskiplistNode和zskiplist两个结构定义。其中zskiplistNode结构用于表示跳跃表节点，而zskiplist结构则用于保存跳跃表节点的相关信息，比如节点的数量，以及指向表头节点和表尾节点的指针等等。<br><img src="http://ocx5m3vc3.bkt.clouddn.com/skiplist.png" alt=""><br><a id="more"></a><br>位于图片最左边的是zskiplist结构，该结构包含以下属性：</p><ul><li>header：指向跳跃表的表头节点。</li><li>tail：指向跳跃表的表尾节点。</li><li>level：记录目前跳跃表内，层数最大的那个节点的层数（表头节点的层数不计算在内）。</li><li>length：记录跳跃表的长度，即是跳跃表目前包含节点的数量（表头节点不计算在内）。<br>位于图片右侧的是zskiplistNode结构，该结构包含以下属性：</li><li>层（level）：每次创建一个新的跳跃表节点的时候，程序都根据幂次定律随机生成一个介于1~32之间的值作为level数组的大小，这就是层的高度。</li><li>前进指针（forward):每层都有一个指向表尾方向的前进指针。</li><li>后退指针（backward）：用于从表尾向表头方向访问节点。</li><li>跨度（span）：用于记录两个节点之间的距离。</li><li>分值（score）</li><li>成员对象（obj）<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">typedef struct zskiplistNode&#123;</div><div class="line">//后退指针</div><div class="line">struct zskiplistNode *backward;</div><div class="line">//分值</div><div class="line">double score;</div><div class="line">//成员对象</div><div class="line">robj *obj;</div><div class="line">//层</div><div class="line">struct zskiplistLevel&#123;</div><div class="line">//前进指针</div><div class="line">struct zskiplistNode *forward;</div><div class="line">//跨度</div><div class="line">unsigned int span;</div><div class="line">&#125;level[];</div><div class="line">&#125;zskiplistNode；</div></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;跳跃表（skiplist）是一种有序数据结构，它通过在每个节点中维持多个指向其他节点的指针，从而达到快速访问节点的目的。&lt;/p&gt;
&lt;h2 id=&quot;跳跃表的实现&quot;&gt;&lt;a href=&quot;#跳跃表的实现&quot; class=&quot;headerlink&quot; title=&quot;跳跃表的实现&quot;&gt;&lt;/a&gt;跳跃表的实现&lt;/h2&gt;&lt;p&gt;Redis跳跃表由zskiplistNode和zskiplist两个结构定义。其中zskiplistNode结构用于表示跳跃表节点，而zskiplist结构则用于保存跳跃表节点的相关信息，比如节点的数量，以及指向表头节点和表尾节点的指针等等。&lt;br&gt;&lt;img src=&quot;http://ocx5m3vc3.bkt.clouddn.com/skiplist.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Redis" scheme="http://yoursite.com/categories/Redis/"/>
    
    
      <category term="Redis" scheme="http://yoursite.com/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis设计与实现-数据结构篇（3）--字典</title>
    <link href="http://yoursite.com/2018/06/10/Redis/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AF%87%EF%BC%883%EF%BC%89-%E5%AD%97%E5%85%B8/"/>
    <id>http://yoursite.com/2018/06/10/Redis/Redis设计与实现-数据结构篇（3）-字典/</id>
    <published>2018-06-10T10:58:15.000Z</published>
    <updated>2018-06-10T12:35:47.856Z</updated>
    
    <content type="html"><![CDATA[<h2 id="字典的实现"><a href="#字典的实现" class="headerlink" title="字典的实现"></a>字典的实现</h2><p>Redis的字典使用哈希表作为底层实现，一个哈希表里面可以有多个哈希表节点，而每个哈希表节点就保存了字典中的一个键值对。</p><h3 id="哈希表"><a href="#哈希表" class="headerlink" title="哈希表"></a>哈希表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">typedef struct dictht&#123;</div><div class="line">//哈希表数组</div><div class="line">dictEntry **table;</div><div class="line">//哈希表大小</div><div class="line">unsigned long size;</div><div class="line">//哈希表大小掩码，用于计算索引值</div><div class="line">//总是等size-1</div><div class="line">unsigned long sizemask;</div><div class="line">//该哈希表已有节点的数量</div><div class="line">unsigned long used;</div><div class="line">&#125;dictht;</div></pre></td></tr></table></figure><p><img src="http://ocx5m3vc3.bkt.clouddn.com/dictht.png" alt=""><br><a id="more"></a><br>table是一个数组，数组中的每个元素都是一个指向dictEntry结构的指针，每个dictEntry结构保存这一个键值对。</p><h3 id="哈希表节点"><a href="#哈希表节点" class="headerlink" title="哈希表节点"></a>哈希表节点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">typedef struct dictEntry&#123;</div><div class="line">//键</div><div class="line">void *key;</div><div class="line">//值</div><div class="line">union&#123;</div><div class="line">void *val;</div><div class="line">uint64_t u64;</div><div class="line">int64_ts64;</div><div class="line">&#125;v;</div><div class="line">//指向下个哈希表节点，形成链表</div><div class="line">struct dictEntry *next;</div><div class="line">&#125;dictEntry;</div></pre></td></tr></table></figure><p><img src="http://ocx5m3vc3.bkt.clouddn.com/dictEntry.png" alt=""></p><h3 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">typedef struct dict&#123;</div><div class="line">//类型特定函数</div><div class="line">dictType *type;</div><div class="line">//私有数据</div><div class="line">void *privdata;</div><div class="line">//哈希表</div><div class="line">dictht ht[2];</div><div class="line">//rehash索引</div><div class="line">//当rehash不在进行时，值为-1</div><div class="line">int trehashidx;</div><div class="line">&#125;dict;</div></pre></td></tr></table></figure><p>ht是一个包含两个项的数组，数组中的每个项都是一个dictht哈希表，一般情况下，字典只使用ht[0]哈希表，ht[1]哈希表只会在ht[0]哈希表进行rehash时使用。<br><img src="http://ocx5m3vc3.bkt.clouddn.com/dict.png" alt=""></p><h2 id="哈希算法"><a href="#哈希算法" class="headerlink" title="哈希算法"></a>哈希算法</h2><p>当要将一个新的键值对添加到字典里面时，程序需要先根据键值对的键计算出哈希值和索引值，然后根据索引值，将包含新键值对的哈希表节点放到哈希表数组的指定索引上面。</p><h2 id="rehash"><a href="#rehash" class="headerlink" title="rehash"></a>rehash</h2><p>随着操作的不断执行，哈希表保存的键值对会逐渐增多或者减少，为了让哈希表的负债因子维持在一个合理的范围内，程序需要对哈希表大小进行相应的扩展或者收缩。<br>步骤：<br>1）为字典的ht[1]哈希表分配空间，这个哈希表的空间大小取决于要执行的操作，以及ht[0]当前包含的键值对数量（也即是ht[0].used属性的值）：<br>2）将保存在ht[0]中的所有键值对rehash到ht[1]上面，rehash值的是重新计算键的哈希值和索引值，然后将键值对放置到ht[1]哈希表的指定位置上。<br>3）当ht[0]包含的所有键值对都迁移到了ht[1]之后（ht[0]变为空表），释放ht[0],将ht[1]设置为ht[0],并在ht[1]新创建一个空白哈希表，为下一次rehash做准备。  </p><h3 id="渐进式rehash"><a href="#渐进式rehash" class="headerlink" title="渐进式rehash"></a>渐进式rehash</h3><p>1）为ht[1]分配空间，让字典同时持有ht[0]和ht[1]两个哈希表。<br>2）在字典中维持一个索引计数器变量rehashidx，并将它的值设置为0，表示rehash工作正式开始。<br>3）在rehash期间，每次对字典执行添加、删除、查找或者更新操作时，程序除了执行指定操作外，还会顺带将ht[0]哈希表再rehashidx索引上的所有键值对rehash到ht[1]，将rehashidx值增加1。<br>4）随着字典操作的不断执行，最终在某个时间点上，ht[0]的所有键值对都会被rehash到ht[1]，这时将rehashidx设置为-1，表示rehash操作完成。</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;字典的实现&quot;&gt;&lt;a href=&quot;#字典的实现&quot; class=&quot;headerlink&quot; title=&quot;字典的实现&quot;&gt;&lt;/a&gt;字典的实现&lt;/h2&gt;&lt;p&gt;Redis的字典使用哈希表作为底层实现，一个哈希表里面可以有多个哈希表节点，而每个哈希表节点就保存了字典中的一个键值对。&lt;/p&gt;
&lt;h3 id=&quot;哈希表&quot;&gt;&lt;a href=&quot;#哈希表&quot; class=&quot;headerlink&quot; title=&quot;哈希表&quot;&gt;&lt;/a&gt;哈希表&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;typedef struct dictht&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	//哈希表数组&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	dictEntry **table;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	//哈希表大小&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	unsigned long size;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	//哈希表大小掩码，用于计算索引值&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	//总是等size-1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	unsigned long sizemask;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	//该哈希表已有节点的数量&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	unsigned long used;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;dictht;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;http://ocx5m3vc3.bkt.clouddn.com/dictht.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Redis" scheme="http://yoursite.com/categories/Redis/"/>
    
    
      <category term="Redis" scheme="http://yoursite.com/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis设计与实现-数据结构篇（2）--链表</title>
    <link href="http://yoursite.com/2018/06/09/Redis/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AF%87%EF%BC%882%EF%BC%89-%E9%93%BE%E8%A1%A8/"/>
    <id>http://yoursite.com/2018/06/09/Redis/Redis设计与实现-数据结构篇（2）-链表/</id>
    <published>2018-06-09T13:09:46.000Z</published>
    <updated>2018-06-10T12:35:44.107Z</updated>
    
    <content type="html"><![CDATA[<h2 id="链表和链表节点的实现"><a href="#链表和链表节点的实现" class="headerlink" title="链表和链表节点的实现"></a>链表和链表节点的实现</h2><p>每个链表节点都使用一个listNode结构来表示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">typedef struct listNode&#123;</div><div class="line">//前置节点</div><div class="line">struct listNode *prev;</div><div class="line">//后置节点</div><div class="line">struct listNode *next;</div><div class="line">//节点的值</div><div class="line">void *value;</div><div class="line">&#125;listNode;</div></pre></td></tr></table></figure></p><p>虽然使用多个listNode结构就可以组成链表，但是使用list来持有链表的话，操作起来会更方便。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">typedef struct list&#123;</div><div class="line">//表头节点</div><div class="line">listNode *head;</div><div class="line">//表尾节点</div><div class="line">listNode *tail;</div><div class="line">//链表所包含的节点数量</div><div class="line">unsigned long len;</div><div class="line">//节点值复制函数</div><div class="line">void *(*dup)(void *ptr);</div><div class="line">//节点值释放函数</div><div class="line">void *(*free)(void *ptr);</div><div class="line">//节点值对比函数</div><div class="line">void *(match)(void *ptr,void *key);</div><div class="line">&#125;list;</div></pre></td></tr></table></figure></p><p><img src="http://ocx5m3vc3.bkt.clouddn.com/list.png" alt=""></p><h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul><li>双端：获取某个节点的前置和后置节点的复杂度都是O(1)</li><li>无环：两端都指向NULL</li><li>获取表头节点和表尾节点的复杂度为O(1)</li><li>O(1)获取链表长度</li><li>链表可以用来保存各种不同类型的值。</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;链表和链表节点的实现&quot;&gt;&lt;a href=&quot;#链表和链表节点的实现&quot; class=&quot;headerlink&quot; title=&quot;链表和链表节点的实现&quot;&gt;&lt;/a&gt;链表和链表节点的实现&lt;/h2&gt;&lt;p&gt;每个链表节点都使用一个listNode结构来表示&lt;br&gt;&lt;figure cl
      
    
    </summary>
    
      <category term="Redis" scheme="http://yoursite.com/categories/Redis/"/>
    
    
      <category term="Redis" scheme="http://yoursite.com/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>杂记</title>
    <link href="http://yoursite.com/2018/06/09/%E5%90%8D%E8%A8%80/"/>
    <id>http://yoursite.com/2018/06/09/名言/</id>
    <published>2018-06-09T12:07:29.000Z</published>
    <updated>2018-06-09T13:58:51.353Z</updated>
    
    <content type="html"><![CDATA[<ul><li>乌云遮蔽了整个天空，闪电便已在其中酝酿。</li><li>世界上只有两种秘密，骗自己的和以为能骗住别人的。</li><li>身不由己的抉择是痛苦的，你看似自己做了决定，但做决定的始终是命运</li><li>越是充满诱惑的东西，往往会越致命。你是否还会选择？</li><li>天空没有痕迹，风雨已在心中。</li><li>天地之间的无形之力，也在无形之中改变着天地。</li><li>在最深沉的夜里，连自己的影子都会离你而去。</li><li>向黑暗走去的人，或许会被黑暗吞噬，或许会化作明灯。</li><li>死亡能带走生命，却带不走生命的痕迹。</li><li>空谷足音，听到的却是自己的心。</li><li>行走在两个世界的边缘，得到更多。</li><li>不要随意翻动回忆，因为它是不可测的深渊。</li><li>花开在天边，而我需要走过一路的荆棘。</li><li>想要看清雾中的景物，不能仅仅相信自己的眼睛。    </li><li>若是献出生命就能赢得正义，我下一刻已身在炽热的烈焰中。</li><li>恶魔的爪牙伸向每个人的心，你是否还依然纯真？</li><li>经历过真正绝望的人，生已是一种施舍，死令他无所畏惧。</li><li>炽热火焰焚尽了执念，灰烬里只留下黑色的心。</li><li>被岁月冰封的一簇火苗，等待理想把它融化、燃烧。</li><li>若承受不了十指连心的痛楚，就别轻易去拼凑记忆的碎片。</li><li>锋芒毕露并不一定耀眼，忍辱负重才是求生之道。</li><li>世间本没有相思，奈何离分人世，将痴心种出了果实。</li><li>蝎子和人的最大区别在于，蝎子往往亮出自己的狠毒，而人则会将之隐藏。</li><li>蒙上双眼，看尽黑暗中的风景，心便不再惧怕。</li><li>枯井中的人仰观宇宙大千，坐拥天下者四顾高墙如井。</li><li>天空其实是无色的，但眼睛欺骗了你；灵魂其实是无欲的，但感情欺骗了你。</li><li>利益这杯美酒让人陶醉，但也同样剧毒无比。</li><li>时间沉淀为回忆，过去沉淀为传奇，你沉淀为我！</li><li>敢于弯腰的树枝，便不会被冰雪压折。</li><li>在落子的瞬间，棋手也是心魔控制的棋子。</li><li>执着与执念的区别，前者是为了守护珍视的人，后者则是逃避内心的怯懦。</li><li>灰烬并不是失败的代表，而是燃烧的证明。</li><li>世上最精致的面具，就是我们自己的脸皮。</li><li>沾过鲜血的剑可以回鞘，但手执利刃的心却无法轻易收回。</li><li>常在夜路独行的人，目光总能捕捉到不易察觉的危险。</li><li>许多东西本该腐朽，那就任它悲戚；许多事情本该舍弃，那就别怪它肆虐。</li><li>不要以世俗得眼光看低我的梦想，现实与虚幻终究是要斗一场。</li><li>在你需要做出选择的时候，你的内心就会经历一场战争。</li><li>即使是无尽的黑暗，舍弃一切踏入的价值，是探索无尽的重点。</li><li>这世上没有能真正忘记的事，只有你愿不愿意想起，和敢不敢想起。</li><li>机会不过是一场稍纵即逝的梦，犹豫只能令你错失改变。</li><li>生之路的尽头，好似铺满了荆棘和玫瑰，每一步都是苦海。</li><li>我们无法避免失败，只能避免因为失败而选择沉沦。</li><li>重点不在他怎么离开，而在其他人看着他背影的目光。</li><li>山高一寸，风景独好一寸，然危机也伏多一寸。</li><li>摘下面具的一场对话，比穿上铠甲奔赴战场更需要勇气。</li><li>规则的制定往往是用来掩盖游戏的本质，用来迷惑那些执着于胜负的人。</li><li>对手和敌人是不同的，敌人希望你更弱，对手希望你更强。</li><li>没有什么能够禁锢你的强大，除了你的内心。</li><li>云淡风轻，满月低垂，脚下万丈悬崖，天空触手可及。</li><li>真相虽隐藏在假象之后，但它总有一天会降临。</li><li>能者逞霸道之势，强者隐百转之谋。</li><li>如果你感到寸步难行，也许是耀眼的光明蒙蔽了你的眼睛。</li><li>直到曲终人散，才知晓真相已暗藏于每个符音间。</li><li>真正的危机，总在不经意时降临。</li><li>隐藏在假象后面的未必是真理，也许是另一个骗局。</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;乌云遮蔽了整个天空，闪电便已在其中酝酿。&lt;/li&gt;
&lt;li&gt;世界上只有两种秘密，骗自己的和以为能骗住别人的。&lt;/li&gt;
&lt;li&gt;身不由己的抉择是痛苦的，你看似自己做了决定，但做决定的始终是命运&lt;/li&gt;
&lt;li&gt;越是充满诱惑的东西，往往会越致命。你是否还会选择？
      
    
    </summary>
    
    
      <category term="杂记" scheme="http://yoursite.com/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Redis设计与实现-数据结构篇（1）--简单动态字符串SDS</title>
    <link href="http://yoursite.com/2018/06/09/Redis/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AF%87%EF%BC%881%EF%BC%89--%E7%AE%80%E5%8D%95%E5%8A%A8%E6%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2SDS/"/>
    <id>http://yoursite.com/2018/06/09/Redis/Redis设计与实现-数据结构篇（1）--简单动态字符串SDS/</id>
    <published>2018-06-09T11:34:13.000Z</published>
    <updated>2018-06-09T13:08:27.986Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Redis中的SDS结构"><a href="#Redis中的SDS结构" class="headerlink" title="Redis中的SDS结构"></a>Redis中的SDS结构</h2><p>Redis并没有直接使用C语言中的字符串，而是自己构建了SDS这样的一种简单动态字符串，并且将它作为Redis中字符串的默认表示。<br>在早期的版本中记录了其长度、剩余空间、以及字符数组；<br>最新版本3.2.4中，已经对SDS做了一定的改动：长度、分配内存大小（除去’\0’）、标志位（低三位表示类型，其余五位未使用）、以及字符数组。<br><img src="http://ocx5m3vc3.bkt.clouddn.com/SDS.png" alt=""><br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">struct sdshdr&#123;</div><div class="line">//buf中已用空间长度</div><div class="line">int len;</div><div class="line">//buf中剩余可用空间长度</div><div class="line">int free;</div><div class="line">//数据空间</div><div class="line">char buf[];</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p><h2 id="SDS与C字符串区别"><a href="#SDS与C字符串区别" class="headerlink" title="SDS与C字符串区别"></a>SDS与C字符串区别</h2><h3 id="获取字符串长度"><a href="#获取字符串长度" class="headerlink" title="获取字符串长度"></a>获取字符串长度</h3><p>&ensp;&ensp;SDS字符串保存了自身的长度，当需要获取长度的时候可以O(1)获得。（3.2中的剩余空间需要用alloc-len算出）</p><h3 id="杜绝缓存区溢出"><a href="#杜绝缓存区溢出" class="headerlink" title="杜绝缓存区溢出"></a>杜绝缓存区溢出</h3><p>&ensp;&ensp;SDS在进行字符串拼接的时候，会自行检查内存空间是否满足要求，如果不满足，将自动进行分配；而且在进行分配空间的时候，会实行预先分配的策略。</p><h3 id="减少修改字符串时带来的内存重分配次数"><a href="#减少修改字符串时带来的内存重分配次数" class="headerlink" title="减少修改字符串时带来的内存重分配次数"></a>减少修改字符串时带来的内存重分配次数</h3><p>&ensp;&ensp;C语言字符串在进行字符串的扩充和收缩的时候，都会面临着内存空间的重新分配问题。<br>&ensp;&ensp;Redis在内存空间分配的问题上进行了优化，只要分为两个过程。  </p><ol><li>内存预分配<br>如果修改之后SDS的长度小于1MB，那么程序将会分配和当前字符串len相同的空间给该字符串对象。<br>如果修改之后的SDS的长度大于等于1MB的话，程序将分配1MB剩余空间给该字符串对象。</li><li>惰性释放<br>当字符串进行缩短操作的时候，并不立即将空间释放出来，而是将这部分空间通过free进行标识。<br>当然，Redis中提供了专门的API，需要的时候，会真正的释放这部分空闲内存。</li></ol><h3 id="二进制安全"><a href="#二进制安全" class="headerlink" title="二进制安全"></a>二进制安全</h3><p>&ensp;&ensp;由于在Redis中，不是根据空字符而是通过len来判断字符串结束的。所以，即便是中间出现了空字符，对于SDS来说，读取该字符串还是可以的。</p><h3 id="兼容部分C语言函数"><a href="#兼容部分C语言函数" class="headerlink" title="兼容部分C语言函数"></a>兼容部分C语言函数</h3>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Redis中的SDS结构&quot;&gt;&lt;a href=&quot;#Redis中的SDS结构&quot; class=&quot;headerlink&quot; title=&quot;Redis中的SDS结构&quot;&gt;&lt;/a&gt;Redis中的SDS结构&lt;/h2&gt;&lt;p&gt;Redis并没有直接使用C语言中的字符串，而是自己构建了SDS这样的一种简单动态字符串，并且将它作为Redis中字符串的默认表示。&lt;br&gt;在早期的版本中记录了其长度、剩余空间、以及字符数组；&lt;br&gt;最新版本3.2.4中，已经对SDS做了一定的改动：长度、分配内存大小（除去’\0’）、标志位（低三位表示类型，其余五位未使用）、以及字符数组。&lt;br&gt;&lt;img src=&quot;http://ocx5m3vc3.bkt.clouddn.com/SDS.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Redis" scheme="http://yoursite.com/categories/Redis/"/>
    
    
      <category term="Redis" scheme="http://yoursite.com/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>Mybatis逆向工程</title>
    <link href="http://yoursite.com/2018/04/23/Mybatis/Mybatis%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/"/>
    <id>http://yoursite.com/2018/04/23/Mybatis/Mybatis逆向工程/</id>
    <published>2018-04-23T12:39:06.000Z</published>
    <updated>2018-04-22T09:37:22.571Z</updated>
    
    <content type="html"><![CDATA[<p>&ensp;&ensp;逆向工程的字面意思就是反向生成工程。<br>使用逆向工程时，需要注意的是表之间的关系无法映射出来！也就是说Mybatis的逆向工程生成的都是单表操作。</p><ol><li><p>Mybatis逆向工程开发文档<br><a href="http://www.mybatis.org/generator/configreference/xmlconfig.html" target="_blank" rel="external">http://www.mybatis.org/generator/configreference/xmlconfig.html</a></p></li><li><p>使用逆向工程生成代码有好几种方式，这里就介绍一种最简单的，Java程序生成（解释在配置中)<br>&ensp;&ensp;2.1 准备逆向工程配置文件genreatorConfig.xml,名字无所谓,只要在java程序中作为file传入就好:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;!DOCTYPE generatorConfiguration</div><div class="line">  PUBLIC &quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</div><div class="line">  &quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;&gt;</div><div class="line">&lt;generatorConfiguration&gt;</div><div class="line">    &lt;!--数据库驱动,最好不要有中文字符,不然会找不到--&gt;</div><div class="line">    &lt;classPathEntry location=&quot;F:/cache/mysql-connector-java-5.1.28-bin.jar&quot; /&gt;</div><div class="line"></div><div class="line"></div><div class="line">    &lt;context id=&quot;DB2Tables&quot;    targetRuntime=&quot;MyBatis3&quot;&gt;</div><div class="line"></div><div class="line">        &lt;commentGenerator&gt;</div><div class="line">            &lt;property name=&quot;suppressDate&quot; value=&quot;true&quot;/&gt;</div><div class="line">            &lt;property name=&quot;suppressAllComments&quot; value=&quot;true&quot;/&gt;</div><div class="line">        &lt;/commentGenerator&gt;</div><div class="line">        &lt;!--数据库链接地址账号密码--&gt;</div><div class="line">        &lt;jdbcConnection driverClass=&quot;com.mysql.jdbc.Driver&quot; connectionURL=&quot;jdbc:mysql://localhost/test&quot; userId=&quot;root&quot; password=&quot;&quot;&gt;</div><div class="line">        &lt;/jdbcConnection&gt;</div><div class="line">        &lt;javaTypeResolver&gt;</div><div class="line">            &lt;property name=&quot;forceBigDecimals&quot; value=&quot;false&quot;/&gt;</div><div class="line">        &lt;/javaTypeResolver&gt;</div><div class="line">        &lt;!--生成Model类存放位置--&gt;</div><div class="line">        &lt;javaModelGenerator targetPackage=&quot;com.leige.domain&quot; targetProject=&quot;src&quot;&gt;</div><div class="line">            &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt;</div><div class="line">            &lt;property name=&quot;trimStrings&quot; value=&quot;true&quot;/&gt;</div><div class="line">        &lt;/javaModelGenerator&gt;</div><div class="line">        &lt;!--生成映射文件存放位置--&gt;</div><div class="line">        &lt;sqlMapGenerator targetPackage=&quot;com.leige.domain&quot; targetProject=&quot;src&quot;&gt;</div><div class="line">            &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt;</div><div class="line">        &lt;/sqlMapGenerator&gt;</div><div class="line">        &lt;!--生成DaoMapper类存放位置--&gt;</div><div class="line">        &lt;javaClientGenerator type=&quot;XMLMAPPER&quot; targetPackage=&quot;com.leige.dao&quot; targetProject=&quot;src&quot;&gt;</div><div class="line">            &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt;</div><div class="line">        &lt;/javaClientGenerator&gt;</div><div class="line">        &lt;!--生成对应表及类名,需要记住的一点是逆向工程无法生成关联关系,只能生成单表操作--&gt;</div><div class="line">        &lt;table tableName=&quot;student&quot; </div><div class="line">            domainObjectName=&quot;Student&quot; </div><div class="line">          &gt;&lt;/table&gt;</div><div class="line">           &lt;table tableName=&quot;teacher&quot; </div><div class="line">            domainObjectName=&quot;Teacher&quot; </div><div class="line">          &gt;&lt;/table&gt;</div><div class="line">    &lt;/context&gt;</div><div class="line">&lt;/generatorConfiguration&gt;</div></pre></td></tr></table></figure></li></ol><a id="more"></a><p>&ensp;&ensp;2.2<a href="http://pan.baidu.com/s/1jIvLufG" target="_blank" rel="external">下载jar包</a><br>&ensp;&ensp;2.3准备java程序,在开发文档首页,粘贴一下就好了,没必要记住:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">package com.leige.test;</div><div class="line"></div><div class="line">import java.awt.geom.GeneralPath;</div><div class="line">import java.awt.im.InputContext;</div><div class="line">import java.io.File;</div><div class="line">import java.io.InputStream;</div><div class="line">import java.util.ArrayList;</div><div class="line">import java.util.List;</div><div class="line"></div><div class="line">import org.apache.ibatis.io.Resources;</div><div class="line">import org.apache.log4j.chainsaw.Main;</div><div class="line">import org.apache.log4j.lf5.util.Resource;</div><div class="line">import org.mybatis.generator.api.MyBatisGenerator;</div><div class="line">import org.mybatis.generator.config.Configuration;</div><div class="line">import org.mybatis.generator.config.xml.ConfigurationParser;</div><div class="line">import org.mybatis.generator.internal.DefaultShellCallback;</div><div class="line"></div><div class="line">public class MybatisGen &#123;</div><div class="line">    public static void generator() throws Exception&#123;</div><div class="line">           List&lt;String&gt; warnings = new ArrayList&lt;String&gt;();</div><div class="line">           boolean overwrite = true;</div><div class="line">           //项目根路径不要有中文,我的有中文,所以使用绝对路径</div><div class="line">           File configFile = new File(&quot;F:/cache/generatorConfig.xml&quot;);</div><div class="line">           ConfigurationParser cp = new ConfigurationParser(warnings);</div><div class="line">           Configuration config = cp.parseConfiguration(configFile);</div><div class="line">           DefaultShellCallback callback = new DefaultShellCallback(overwrite);</div><div class="line">           MyBatisGenerator myBatisGenerator = new MyBatisGenerator(config, callback, warnings);</div><div class="line">           myBatisGenerator.generate(null);</div><div class="line">    &#125;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        try &#123;</div><div class="line">            generator();</div><div class="line">        &#125; catch (Exception e) &#123;</div><div class="line">            // TODO Auto-generated catch block</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>&ensp;&ensp;2.4运行java程序,就会发现生成的代码: </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;ensp;&amp;ensp;逆向工程的字面意思就是反向生成工程。&lt;br&gt;使用逆向工程时，需要注意的是表之间的关系无法映射出来！也就是说Mybatis的逆向工程生成的都是单表操作。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Mybatis逆向工程开发文档&lt;br&gt;&lt;a href=&quot;http://www.mybatis.org/generator/configreference/xmlconfig.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.mybatis.org/generator/configreference/xmlconfig.html&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;使用逆向工程生成代码有好几种方式，这里就介绍一种最简单的，Java程序生成（解释在配置中)&lt;br&gt;&amp;ensp;&amp;ensp;2.1 准备逆向工程配置文件genreatorConfig.xml,名字无所谓,只要在java程序中作为file传入就好:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;!DOCTYPE generatorConfiguration&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  PUBLIC &amp;quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&amp;quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&amp;quot;&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;generatorConfiguration&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;lt;!--数据库驱动,最好不要有中文字符,不然会找不到--&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;lt;classPathEntry location=&amp;quot;F:/cache/mysql-connector-java-5.1.28-bin.jar&amp;quot; /&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;lt;context id=&amp;quot;DB2Tables&amp;quot;    targetRuntime=&amp;quot;MyBatis3&amp;quot;&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;commentGenerator&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;lt;property name=&amp;quot;suppressDate&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;lt;property name=&amp;quot;suppressAllComments&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;/commentGenerator&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;!--数据库链接地址账号密码--&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;jdbcConnection driverClass=&amp;quot;com.mysql.jdbc.Driver&amp;quot; connectionURL=&amp;quot;jdbc:mysql://localhost/test&amp;quot; userId=&amp;quot;root&amp;quot; password=&amp;quot;&amp;quot;&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;/jdbcConnection&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;javaTypeResolver&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;lt;property name=&amp;quot;forceBigDecimals&amp;quot; value=&amp;quot;false&amp;quot;/&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;/javaTypeResolver&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;!--生成Model类存放位置--&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;javaModelGenerator targetPackage=&amp;quot;com.leige.domain&amp;quot; targetProject=&amp;quot;src&amp;quot;&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;lt;property name=&amp;quot;enableSubPackages&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;lt;property name=&amp;quot;trimStrings&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;/javaModelGenerator&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;!--生成映射文件存放位置--&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;sqlMapGenerator targetPackage=&amp;quot;com.leige.domain&amp;quot; targetProject=&amp;quot;src&amp;quot;&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;lt;property name=&amp;quot;enableSubPackages&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;/sqlMapGenerator&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;!--生成DaoMapper类存放位置--&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;javaClientGenerator type=&amp;quot;XMLMAPPER&amp;quot; targetPackage=&amp;quot;com.leige.dao&amp;quot; targetProject=&amp;quot;src&amp;quot;&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;lt;property name=&amp;quot;enableSubPackages&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;/javaClientGenerator&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;!--生成对应表及类名,需要记住的一点是逆向工程无法生成关联关系,只能生成单表操作--&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;table tableName=&amp;quot;student&amp;quot; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            domainObjectName=&amp;quot;Student&amp;quot; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &amp;gt;&amp;lt;/table&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;           &amp;lt;table tableName=&amp;quot;teacher&amp;quot; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            domainObjectName=&amp;quot;Teacher&amp;quot; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &amp;gt;&amp;lt;/table&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;lt;/context&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;/generatorConfiguration&amp;gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="框架" scheme="http://yoursite.com/categories/%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="Mybatis" scheme="http://yoursite.com/tags/Mybatis/"/>
    
  </entry>
  
</feed>
